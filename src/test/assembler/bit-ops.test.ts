import "mocha";
import { codeRaisesError, testCodeEmit } from "./test-helpers";

describe("Assembler - bit operations", function () {
  this.timeout(20_000);

  it("bit", async () => {
    await testCodeEmit("bit 0,b", 0xcb, 0x40);
    await testCodeEmit("bit 0,c", 0xcb, 0x41);
    await testCodeEmit("bit 0,d", 0xcb, 0x42);
    await testCodeEmit("bit 0,e", 0xcb, 0x43);
    await testCodeEmit("bit 0,h", 0xcb, 0x44);
    await testCodeEmit("bit 0,l", 0xcb, 0x45);
    await testCodeEmit("bit 0,(hl)", 0xcb, 0x46);
    await testCodeEmit("bit 0,a", 0xcb, 0x47);

    await testCodeEmit("bit 1,b", 0xcb, 0x48);
    await testCodeEmit("bit 1,c", 0xcb, 0x49);
    await testCodeEmit("bit 1,d", 0xcb, 0x4a);
    await testCodeEmit("bit 1,e", 0xcb, 0x4b);
    await testCodeEmit("bit 1,h", 0xcb, 0x4c);
    await testCodeEmit("bit 1,l", 0xcb, 0x4d);
    await testCodeEmit("bit 1,(hl)", 0xcb, 0x4e);
    await testCodeEmit("bit 1,a", 0xcb, 0x4f);

    await testCodeEmit("bit 2,b", 0xcb, 0x50);
    await testCodeEmit("bit 2,c", 0xcb, 0x51);
    await testCodeEmit("bit 2,d", 0xcb, 0x52);
    await testCodeEmit("bit 2,e", 0xcb, 0x53);
    await testCodeEmit("bit 2,h", 0xcb, 0x54);
    await testCodeEmit("bit 2,l", 0xcb, 0x55);
    await testCodeEmit("bit 2,(hl)", 0xcb, 0x56);
    await testCodeEmit("bit 2,a", 0xcb, 0x57);

    await testCodeEmit("bit 3,b", 0xcb, 0x58);
    await testCodeEmit("bit 3,c", 0xcb, 0x59);
    await testCodeEmit("bit 3,d", 0xcb, 0x5a);
    await testCodeEmit("bit 3,e", 0xcb, 0x5b);
    await testCodeEmit("bit 3,h", 0xcb, 0x5c);
    await testCodeEmit("bit 3,l", 0xcb, 0x5d);
    await testCodeEmit("bit 3,(hl)", 0xcb, 0x5e);
    await testCodeEmit("bit 3,a", 0xcb, 0x5f);

    await testCodeEmit("bit 4,b", 0xcb, 0x60);
    await testCodeEmit("bit 4,c", 0xcb, 0x61);
    await testCodeEmit("bit 4,d", 0xcb, 0x62);
    await testCodeEmit("bit 4,e", 0xcb, 0x63);
    await testCodeEmit("bit 4,h", 0xcb, 0x64);
    await testCodeEmit("bit 4,l", 0xcb, 0x65);
    await testCodeEmit("bit 4,(hl)", 0xcb, 0x66);
    await testCodeEmit("bit 4,a", 0xcb, 0x67);

    await testCodeEmit("bit 5,b", 0xcb, 0x68);
    await testCodeEmit("bit 5,c", 0xcb, 0x69);
    await testCodeEmit("bit 5,d", 0xcb, 0x6a);
    await testCodeEmit("bit 5,e", 0xcb, 0x6b);
    await testCodeEmit("bit 5,h", 0xcb, 0x6c);
    await testCodeEmit("bit 5,l", 0xcb, 0x6d);
    await testCodeEmit("bit 5,(hl)", 0xcb, 0x6e);
    await testCodeEmit("bit 5,a", 0xcb, 0x6f);

    await testCodeEmit("bit 6,b", 0xcb, 0x70);
    await testCodeEmit("bit 6,c", 0xcb, 0x71);
    await testCodeEmit("bit 6,d", 0xcb, 0x72);
    await testCodeEmit("bit 6,e", 0xcb, 0x73);
    await testCodeEmit("bit 6,h", 0xcb, 0x74);
    await testCodeEmit("bit 6,l", 0xcb, 0x75);
    await testCodeEmit("bit 6,(hl)", 0xcb, 0x76);
    await testCodeEmit("bit 6,a", 0xcb, 0x77);

    await testCodeEmit("bit 7,b", 0xcb, 0x78);
    await testCodeEmit("bit 7,c", 0xcb, 0x79);
    await testCodeEmit("bit 7,d", 0xcb, 0x7a);
    await testCodeEmit("bit 7,e", 0xcb, 0x7b);
    await testCodeEmit("bit 7,h", 0xcb, 0x7c);
    await testCodeEmit("bit 7,l", 0xcb, 0x7d);
    await testCodeEmit("bit 7,(hl)", 0xcb, 0x7e);
    await testCodeEmit("bit 7,a", 0xcb, 0x7f);
  });

  it("bit: fails with invalid operand", async () => {
    await codeRaisesError("bit -1,b", "Z0407");
    await codeRaisesError("bit 8,b", "Z0407");
  });

  it("bit: indexed instructions", async () => {
    await testCodeEmit("bit 0,(ix)", 0xdd, 0xcb, 0x00, 0x46);
    await testCodeEmit("bit 0,(ix+6)", 0xdd, 0xcb, 0x06, 0x46);
    await testCodeEmit("bit 0,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x46);
    await testCodeEmit("bit 1,(ix)", 0xdd, 0xcb, 0x00, 0x4e);
    await testCodeEmit("bit 1,(ix+6)", 0xdd, 0xcb, 0x06, 0x4e);
    await testCodeEmit("bit 1,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x4e);
    await testCodeEmit("bit 2,(ix)", 0xdd, 0xcb, 0x00, 0x56);
    await testCodeEmit("bit 2,(ix+6)", 0xdd, 0xcb, 0x06, 0x56);
    await testCodeEmit("bit 2,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x56);
    await testCodeEmit("bit 3,(ix)", 0xdd, 0xcb, 0x00, 0x5e);
    await testCodeEmit("bit 3,(ix+6)", 0xdd, 0xcb, 0x06, 0x5e);
    await testCodeEmit("bit 3,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x5e);
    await testCodeEmit("bit 4,(ix)", 0xdd, 0xcb, 0x00, 0x66);
    await testCodeEmit("bit 4,(ix+6)", 0xdd, 0xcb, 0x06, 0x66);
    await testCodeEmit("bit 4,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x66);
    await testCodeEmit("bit 5,(ix)", 0xdd, 0xcb, 0x00, 0x6e);
    await testCodeEmit("bit 5,(ix+6)", 0xdd, 0xcb, 0x06, 0x6e);
    await testCodeEmit("bit 5,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x6e);
    await testCodeEmit("bit 6,(ix)", 0xdd, 0xcb, 0x00, 0x76);
    await testCodeEmit("bit 6,(ix+6)", 0xdd, 0xcb, 0x06, 0x76);
    await testCodeEmit("bit 6,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x76);
    await testCodeEmit("bit 7,(ix)", 0xdd, 0xcb, 0x00, 0x7e);
    await testCodeEmit("bit 7,(ix+6)", 0xdd, 0xcb, 0x06, 0x7e);
    await testCodeEmit("bit 7,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x7e);
    await testCodeEmit("bit 0,(iy)", 0xfd, 0xcb, 0x00, 0x46);
    await testCodeEmit("bit 0,(iy+6)", 0xfd, 0xcb, 0x06, 0x46);
    await testCodeEmit("bit 0,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x46);
    await testCodeEmit("bit 1,(iy)", 0xfd, 0xcb, 0x00, 0x4e);
    await testCodeEmit("bit 1,(iy+6)", 0xfd, 0xcb, 0x06, 0x4e);
    await testCodeEmit("bit 1,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x4e);
    await testCodeEmit("bit 2,(iy)", 0xfd, 0xcb, 0x00, 0x56);
    await testCodeEmit("bit 2,(iy+6)", 0xfd, 0xcb, 0x06, 0x56);
    await testCodeEmit("bit 2,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x56);
    await testCodeEmit("bit 3,(iy)", 0xfd, 0xcb, 0x00, 0x5e);
    await testCodeEmit("bit 3,(iy+6)", 0xfd, 0xcb, 0x06, 0x5e);
    await testCodeEmit("bit 3,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x5e);
    await testCodeEmit("bit 4,(iy)", 0xfd, 0xcb, 0x00, 0x66);
    await testCodeEmit("bit 4,(iy+6)", 0xfd, 0xcb, 0x06, 0x66);
    await testCodeEmit("bit 4,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x66);
    await testCodeEmit("bit 5,(iy)", 0xfd, 0xcb, 0x00, 0x6e);
    await testCodeEmit("bit 5,(iy+6)", 0xfd, 0xcb, 0x06, 0x6e);
    await testCodeEmit("bit 5,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x6e);
    await testCodeEmit("bit 6,(iy)", 0xfd, 0xcb, 0x00, 0x76);
    await testCodeEmit("bit 6,(iy+6)", 0xfd, 0xcb, 0x06, 0x76);
    await testCodeEmit("bit 6,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x76);
    await testCodeEmit("bit 7,(iy)", 0xfd, 0xcb, 0x00, 0x7e);
    await testCodeEmit("bit 7,(iy+6)", 0xfd, 0xcb, 0x06, 0x7e);
    await testCodeEmit("bit 7,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x7e);
  });

  it("res", async () => {
    await testCodeEmit("res 0,b", 0xcb, 0x80);
    await testCodeEmit("res 0,c", 0xcb, 0x81);
    await testCodeEmit("res 0,d", 0xcb, 0x82);
    await testCodeEmit("res 0,e", 0xcb, 0x83);
    await testCodeEmit("res 0,h", 0xcb, 0x84);
    await testCodeEmit("res 0,l", 0xcb, 0x85);
    await testCodeEmit("res 0,(hl)", 0xcb, 0x86);
    await testCodeEmit("res 0,a", 0xcb, 0x87);

    await testCodeEmit("res 1,b", 0xcb, 0x88);
    await testCodeEmit("res 1,c", 0xcb, 0x89);
    await testCodeEmit("res 1,d", 0xcb, 0x8a);
    await testCodeEmit("res 1,e", 0xcb, 0x8b);
    await testCodeEmit("res 1,h", 0xcb, 0x8c);
    await testCodeEmit("res 1,l", 0xcb, 0x8d);
    await testCodeEmit("res 1,(hl)", 0xcb, 0x8e);
    await testCodeEmit("res 1,a", 0xcb, 0x8f);

    await testCodeEmit("res 2,b", 0xcb, 0x90);
    await testCodeEmit("res 2,c", 0xcb, 0x91);
    await testCodeEmit("res 2,d", 0xcb, 0x92);
    await testCodeEmit("res 2,e", 0xcb, 0x93);
    await testCodeEmit("res 2,h", 0xcb, 0x94);
    await testCodeEmit("res 2,l", 0xcb, 0x95);
    await testCodeEmit("res 2,(hl)", 0xcb, 0x96);
    await testCodeEmit("res 2,a", 0xcb, 0x97);

    await testCodeEmit("res 3,b", 0xcb, 0x98);
    await testCodeEmit("res 3,c", 0xcb, 0x99);
    await testCodeEmit("res 3,d", 0xcb, 0x9a);
    await testCodeEmit("res 3,e", 0xcb, 0x9b);
    await testCodeEmit("res 3,h", 0xcb, 0x9c);
    await testCodeEmit("res 3,l", 0xcb, 0x9d);
    await testCodeEmit("res 3,(hl)", 0xcb, 0x9e);
    await testCodeEmit("res 3,a", 0xcb, 0x9f);

    await testCodeEmit("res 4,b", 0xcb, 0xa0);
    await testCodeEmit("res 4,c", 0xcb, 0xa1);
    await testCodeEmit("res 4,d", 0xcb, 0xa2);
    await testCodeEmit("res 4,e", 0xcb, 0xa3);
    await testCodeEmit("res 4,h", 0xcb, 0xa4);
    await testCodeEmit("res 4,l", 0xcb, 0xa5);
    await testCodeEmit("res 4,(hl)", 0xcb, 0xa6);
    await testCodeEmit("res 4,a", 0xcb, 0xa7);

    await testCodeEmit("res 5,b", 0xcb, 0xa8);
    await testCodeEmit("res 5,c", 0xcb, 0xa9);
    await testCodeEmit("res 5,d", 0xcb, 0xaa);
    await testCodeEmit("res 5,e", 0xcb, 0xab);
    await testCodeEmit("res 5,h", 0xcb, 0xac);
    await testCodeEmit("res 5,l", 0xcb, 0xad);
    await testCodeEmit("res 5,(hl)", 0xcb, 0xae);
    await testCodeEmit("res 5,a", 0xcb, 0xaf);

    await testCodeEmit("res 6,b", 0xcb, 0xb0);
    await testCodeEmit("res 6,c", 0xcb, 0xb1);
    await testCodeEmit("res 6,d", 0xcb, 0xb2);
    await testCodeEmit("res 6,e", 0xcb, 0xb3);
    await testCodeEmit("res 6,h", 0xcb, 0xb4);
    await testCodeEmit("res 6,l", 0xcb, 0xb5);
    await testCodeEmit("res 6,(hl)", 0xcb, 0xb6);
    await testCodeEmit("res 6,a", 0xcb, 0xb7);

    await testCodeEmit("res 7,b", 0xcb, 0xb8);
    await testCodeEmit("res 7,c", 0xcb, 0xb9);
    await testCodeEmit("res 7,d", 0xcb, 0xba);
    await testCodeEmit("res 7,e", 0xcb, 0xbb);
    await testCodeEmit("res 7,h", 0xcb, 0xbc);
    await testCodeEmit("res 7,l", 0xcb, 0xbd);
    await testCodeEmit("res 7,(hl)", 0xcb, 0xbe);
    await testCodeEmit("res 7,a", 0xcb, 0xbf);
  });

  it("res: fails with invalid operand", async () => {
    await codeRaisesError("res -1,b", "Z0407");
    await codeRaisesError("res 8,b", "Z0407");
  });

  it("res: indexed instructions", async () => {
    await testCodeEmit("res 0,(ix),b", 0xdd, 0xcb, 0x00, 0x80);
    await testCodeEmit("res 0,(ix+6),b", 0xdd, 0xcb, 0x06, 0x80);
    await testCodeEmit("res 0,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0x80);
    await testCodeEmit("res 0,(ix),c", 0xdd, 0xcb, 0x00, 0x81);
    await testCodeEmit("res 0,(ix+6),c", 0xdd, 0xcb, 0x06, 0x81);
    await testCodeEmit("res 0,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0x81);
    await testCodeEmit("res 0,(ix),d", 0xdd, 0xcb, 0x00, 0x82);
    await testCodeEmit("res 0,(ix+6),d", 0xdd, 0xcb, 0x06, 0x82);
    await testCodeEmit("res 0,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0x82);
    await testCodeEmit("res 0,(ix),e", 0xdd, 0xcb, 0x00, 0x83);
    await testCodeEmit("res 0,(ix+6),e", 0xdd, 0xcb, 0x06, 0x83);
    await testCodeEmit("res 0,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0x83);
    await testCodeEmit("res 0,(ix),h", 0xdd, 0xcb, 0x00, 0x84);
    await testCodeEmit("res 0,(ix+6),h", 0xdd, 0xcb, 0x06, 0x84);
    await testCodeEmit("res 0,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0x84);
    await testCodeEmit("res 0,(ix),l", 0xdd, 0xcb, 0x00, 0x85);
    await testCodeEmit("res 0,(ix+6),l", 0xdd, 0xcb, 0x06, 0x85);
    await testCodeEmit("res 0,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0x85);
    await testCodeEmit("res 0,(ix)", 0xdd, 0xcb, 0x00, 0x86);
    await testCodeEmit("res 0,(ix+6)", 0xdd, 0xcb, 0x06, 0x86);
    await testCodeEmit("res 0,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x86);
    await testCodeEmit("res 0,(ix),a", 0xdd, 0xcb, 0x00, 0x87);
    await testCodeEmit("res 0,(ix+6),a", 0xdd, 0xcb, 0x06, 0x87);
    await testCodeEmit("res 0,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0x87);

    await testCodeEmit("res 1,(ix),b", 0xdd, 0xcb, 0x00, 0x88);
    await testCodeEmit("res 1,(ix+6),b", 0xdd, 0xcb, 0x06, 0x88);
    await testCodeEmit("res 1,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0x88);
    await testCodeEmit("res 1,(ix),c", 0xdd, 0xcb, 0x00, 0x89);
    await testCodeEmit("res 1,(ix+6),c", 0xdd, 0xcb, 0x06, 0x89);
    await testCodeEmit("res 1,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0x89);
    await testCodeEmit("res 1,(ix),d", 0xdd, 0xcb, 0x00, 0x8a);
    await testCodeEmit("res 1,(ix+6),d", 0xdd, 0xcb, 0x06, 0x8a);
    await testCodeEmit("res 1,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0x8a);
    await testCodeEmit("res 1,(ix),e", 0xdd, 0xcb, 0x00, 0x8b);
    await testCodeEmit("res 1,(ix+6),e", 0xdd, 0xcb, 0x06, 0x8b);
    await testCodeEmit("res 1,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0x8b);
    await testCodeEmit("res 1,(ix),h", 0xdd, 0xcb, 0x00, 0x8c);
    await testCodeEmit("res 1,(ix+6),h", 0xdd, 0xcb, 0x06, 0x8c);
    await testCodeEmit("res 1,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0x8c);
    await testCodeEmit("res 1,(ix),l", 0xdd, 0xcb, 0x00, 0x8d);
    await testCodeEmit("res 1,(ix+6),l", 0xdd, 0xcb, 0x06, 0x8d);
    await testCodeEmit("res 1,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0x8d);
    await testCodeEmit("res 1,(ix)", 0xdd, 0xcb, 0x00, 0x8e);
    await testCodeEmit("res 1,(ix+6)", 0xdd, 0xcb, 0x06, 0x8e);
    await testCodeEmit("res 1,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x8e);
    await testCodeEmit("res 1,(ix),a", 0xdd, 0xcb, 0x00, 0x8f);
    await testCodeEmit("res 1,(ix+6),a", 0xdd, 0xcb, 0x06, 0x8f);
    await testCodeEmit("res 1,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0x8f);

    await testCodeEmit("res 2,(ix),b", 0xdd, 0xcb, 0x00, 0x90);
    await testCodeEmit("res 2,(ix+6),b", 0xdd, 0xcb, 0x06, 0x90);
    await testCodeEmit("res 2,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0x90);
    await testCodeEmit("res 2,(ix),c", 0xdd, 0xcb, 0x00, 0x91);
    await testCodeEmit("res 2,(ix+6),c", 0xdd, 0xcb, 0x06, 0x91);
    await testCodeEmit("res 2,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0x91);
    await testCodeEmit("res 2,(ix),d", 0xdd, 0xcb, 0x00, 0x92);
    await testCodeEmit("res 2,(ix+6),d", 0xdd, 0xcb, 0x06, 0x92);
    await testCodeEmit("res 2,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0x92);
    await testCodeEmit("res 2,(ix),e", 0xdd, 0xcb, 0x00, 0x93);
    await testCodeEmit("res 2,(ix+6),e", 0xdd, 0xcb, 0x06, 0x93);
    await testCodeEmit("res 2,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0x93);
    await testCodeEmit("res 2,(ix),h", 0xdd, 0xcb, 0x00, 0x94);
    await testCodeEmit("res 2,(ix+6),h", 0xdd, 0xcb, 0x06, 0x94);
    await testCodeEmit("res 2,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0x94);
    await testCodeEmit("res 2,(ix),l", 0xdd, 0xcb, 0x00, 0x95);
    await testCodeEmit("res 2,(ix+6),l", 0xdd, 0xcb, 0x06, 0x95);
    await testCodeEmit("res 2,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0x95);
    await testCodeEmit("res 2,(ix)", 0xdd, 0xcb, 0x00, 0x96);
    await testCodeEmit("res 2,(ix+6)", 0xdd, 0xcb, 0x06, 0x96);
    await testCodeEmit("res 2,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x96);
    await testCodeEmit("res 2,(ix),a", 0xdd, 0xcb, 0x00, 0x97);
    await testCodeEmit("res 2,(ix+6),a", 0xdd, 0xcb, 0x06, 0x97);
    await testCodeEmit("res 2,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0x97);

    await testCodeEmit("res 3,(ix),b", 0xdd, 0xcb, 0x00, 0x98);
    await testCodeEmit("res 3,(ix+6),b", 0xdd, 0xcb, 0x06, 0x98);
    await testCodeEmit("res 3,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0x98);
    await testCodeEmit("res 3,(ix),c", 0xdd, 0xcb, 0x00, 0x99);
    await testCodeEmit("res 3,(ix+6),c", 0xdd, 0xcb, 0x06, 0x99);
    await testCodeEmit("res 3,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0x99);
    await testCodeEmit("res 3,(ix),d", 0xdd, 0xcb, 0x00, 0x9a);
    await testCodeEmit("res 3,(ix+6),d", 0xdd, 0xcb, 0x06, 0x9a);
    await testCodeEmit("res 3,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0x9a);
    await testCodeEmit("res 3,(ix),e", 0xdd, 0xcb, 0x00, 0x9b);
    await testCodeEmit("res 3,(ix+6),e", 0xdd, 0xcb, 0x06, 0x9b);
    await testCodeEmit("res 3,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0x9b);
    await testCodeEmit("res 3,(ix),h", 0xdd, 0xcb, 0x00, 0x9c);
    await testCodeEmit("res 3,(ix+6),h", 0xdd, 0xcb, 0x06, 0x9c);
    await testCodeEmit("res 3,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0x9c);
    await testCodeEmit("res 3,(ix),l", 0xdd, 0xcb, 0x00, 0x9d);
    await testCodeEmit("res 3,(ix+6),l", 0xdd, 0xcb, 0x06, 0x9d);
    await testCodeEmit("res 3,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0x9d);
    await testCodeEmit("res 3,(ix)", 0xdd, 0xcb, 0x00, 0x9e);
    await testCodeEmit("res 3,(ix+6)", 0xdd, 0xcb, 0x06, 0x9e);
    await testCodeEmit("res 3,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0x9e);
    await testCodeEmit("res 3,(ix),a", 0xdd, 0xcb, 0x00, 0x9f);
    await testCodeEmit("res 3,(ix+6),a", 0xdd, 0xcb, 0x06, 0x9f);
    await testCodeEmit("res 3,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0x9f);

    await testCodeEmit("res 4,(ix),b", 0xdd, 0xcb, 0x00, 0xa0);
    await testCodeEmit("res 4,(ix+6),b", 0xdd, 0xcb, 0x06, 0xa0);
    await testCodeEmit("res 4,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xa0);
    await testCodeEmit("res 4,(ix),c", 0xdd, 0xcb, 0x00, 0xa1);
    await testCodeEmit("res 4,(ix+6),c", 0xdd, 0xcb, 0x06, 0xa1);
    await testCodeEmit("res 4,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xa1);
    await testCodeEmit("res 4,(ix),d", 0xdd, 0xcb, 0x00, 0xa2);
    await testCodeEmit("res 4,(ix+6),d", 0xdd, 0xcb, 0x06, 0xa2);
    await testCodeEmit("res 4,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xa2);
    await testCodeEmit("res 4,(ix),e", 0xdd, 0xcb, 0x00, 0xa3);
    await testCodeEmit("res 4,(ix+6),e", 0xdd, 0xcb, 0x06, 0xa3);
    await testCodeEmit("res 4,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xa3);
    await testCodeEmit("res 4,(ix),h", 0xdd, 0xcb, 0x00, 0xa4);
    await testCodeEmit("res 4,(ix+6),h", 0xdd, 0xcb, 0x06, 0xa4);
    await testCodeEmit("res 4,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xa4);
    await testCodeEmit("res 4,(ix),l", 0xdd, 0xcb, 0x00, 0xa5);
    await testCodeEmit("res 4,(ix+6),l", 0xdd, 0xcb, 0x06, 0xa5);
    await testCodeEmit("res 4,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xa5);
    await testCodeEmit("res 4,(ix)", 0xdd, 0xcb, 0x00, 0xa6);
    await testCodeEmit("res 4,(ix+6)", 0xdd, 0xcb, 0x06, 0xa6);
    await testCodeEmit("res 4,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xa6);
    await testCodeEmit("res 4,(ix),a", 0xdd, 0xcb, 0x00, 0xa7);
    await testCodeEmit("res 4,(ix+6),a", 0xdd, 0xcb, 0x06, 0xa7);
    await testCodeEmit("res 4,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xa7);

    await testCodeEmit("res 5,(ix),b", 0xdd, 0xcb, 0x00, 0xa8);
    await testCodeEmit("res 5,(ix+6),b", 0xdd, 0xcb, 0x06, 0xa8);
    await testCodeEmit("res 5,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xa8);
    await testCodeEmit("res 5,(ix),c", 0xdd, 0xcb, 0x00, 0xa9);
    await testCodeEmit("res 5,(ix+6),c", 0xdd, 0xcb, 0x06, 0xa9);
    await testCodeEmit("res 5,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xa9);
    await testCodeEmit("res 5,(ix),d", 0xdd, 0xcb, 0x00, 0xaa);
    await testCodeEmit("res 5,(ix+6),d", 0xdd, 0xcb, 0x06, 0xaa);
    await testCodeEmit("res 5,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xaa);
    await testCodeEmit("res 5,(ix),e", 0xdd, 0xcb, 0x00, 0xab);
    await testCodeEmit("res 5,(ix+6),e", 0xdd, 0xcb, 0x06, 0xab);
    await testCodeEmit("res 5,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xab);
    await testCodeEmit("res 5,(ix),h", 0xdd, 0xcb, 0x00, 0xac);
    await testCodeEmit("res 5,(ix+6),h", 0xdd, 0xcb, 0x06, 0xac);
    await testCodeEmit("res 5,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xac);
    await testCodeEmit("res 5,(ix),l", 0xdd, 0xcb, 0x00, 0xad);
    await testCodeEmit("res 5,(ix+6),l", 0xdd, 0xcb, 0x06, 0xad);
    await testCodeEmit("res 5,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xad);
    await testCodeEmit("res 5,(ix)", 0xdd, 0xcb, 0x00, 0xae);
    await testCodeEmit("res 5,(ix+6)", 0xdd, 0xcb, 0x06, 0xae);
    await testCodeEmit("res 5,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xae);
    await testCodeEmit("res 5,(ix),a", 0xdd, 0xcb, 0x00, 0xaf);
    await testCodeEmit("res 5,(ix+6),a", 0xdd, 0xcb, 0x06, 0xaf);
    await testCodeEmit("res 5,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xaf);

    await testCodeEmit("res 6,(ix),b", 0xdd, 0xcb, 0x00, 0xb0);
    await testCodeEmit("res 6,(ix+6),b", 0xdd, 0xcb, 0x06, 0xb0);
    await testCodeEmit("res 6,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xb0);
    await testCodeEmit("res 6,(ix),c", 0xdd, 0xcb, 0x00, 0xb1);
    await testCodeEmit("res 6,(ix+6),c", 0xdd, 0xcb, 0x06, 0xb1);
    await testCodeEmit("res 6,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xb1);
    await testCodeEmit("res 6,(ix),d", 0xdd, 0xcb, 0x00, 0xb2);
    await testCodeEmit("res 6,(ix+6),d", 0xdd, 0xcb, 0x06, 0xb2);
    await testCodeEmit("res 6,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xb2);
    await testCodeEmit("res 6,(ix),e", 0xdd, 0xcb, 0x00, 0xb3);
    await testCodeEmit("res 6,(ix+6),e", 0xdd, 0xcb, 0x06, 0xb3);
    await testCodeEmit("res 6,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xb3);
    await testCodeEmit("res 6,(ix),h", 0xdd, 0xcb, 0x00, 0xb4);
    await testCodeEmit("res 6,(ix+6),h", 0xdd, 0xcb, 0x06, 0xb4);
    await testCodeEmit("res 6,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xb4);
    await testCodeEmit("res 6,(ix),l", 0xdd, 0xcb, 0x00, 0xb5);
    await testCodeEmit("res 6,(ix+6),l", 0xdd, 0xcb, 0x06, 0xb5);
    await testCodeEmit("res 6,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xb5);
    await testCodeEmit("res 6,(ix)", 0xdd, 0xcb, 0x00, 0xb6);
    await testCodeEmit("res 6,(ix+6)", 0xdd, 0xcb, 0x06, 0xb6);
    await testCodeEmit("res 6,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xb6);
    await testCodeEmit("res 6,(ix),a", 0xdd, 0xcb, 0x00, 0xb7);
    await testCodeEmit("res 6,(ix+6),a", 0xdd, 0xcb, 0x06, 0xb7);
    await testCodeEmit("res 6,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xb7);

    await testCodeEmit("res 7,(ix),b", 0xdd, 0xcb, 0x00, 0xb8);
    await testCodeEmit("res 7,(ix+6),b", 0xdd, 0xcb, 0x06, 0xb8);
    await testCodeEmit("res 7,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xb8);
    await testCodeEmit("res 7,(ix),c", 0xdd, 0xcb, 0x00, 0xb9);
    await testCodeEmit("res 7,(ix+6),c", 0xdd, 0xcb, 0x06, 0xb9);
    await testCodeEmit("res 7,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xb9);
    await testCodeEmit("res 7,(ix),d", 0xdd, 0xcb, 0x00, 0xba);
    await testCodeEmit("res 7,(ix+6),d", 0xdd, 0xcb, 0x06, 0xba);
    await testCodeEmit("res 7,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xba);
    await testCodeEmit("res 7,(ix),e", 0xdd, 0xcb, 0x00, 0xbb);
    await testCodeEmit("res 7,(ix+6),e", 0xdd, 0xcb, 0x06, 0xbb);
    await testCodeEmit("res 7,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xbb);
    await testCodeEmit("res 7,(ix),h", 0xdd, 0xcb, 0x00, 0xbc);
    await testCodeEmit("res 7,(ix+6),h", 0xdd, 0xcb, 0x06, 0xbc);
    await testCodeEmit("res 7,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xbc);
    await testCodeEmit("res 7,(ix),l", 0xdd, 0xcb, 0x00, 0xbd);
    await testCodeEmit("res 7,(ix+6),l", 0xdd, 0xcb, 0x06, 0xbd);
    await testCodeEmit("res 7,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xbd);
    await testCodeEmit("res 7,(ix)", 0xdd, 0xcb, 0x00, 0xbe);
    await testCodeEmit("res 7,(ix+6)", 0xdd, 0xcb, 0x06, 0xbe);
    await testCodeEmit("res 7,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xbe);
    await testCodeEmit("res 7,(ix),a", 0xdd, 0xcb, 0x00, 0xbf);
    await testCodeEmit("res 7,(ix+6),a", 0xdd, 0xcb, 0x06, 0xbf);
    await testCodeEmit("res 7,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xbf);

    await testCodeEmit("res 0,(iy),b", 0xfd, 0xcb, 0x00, 0x80);
    await testCodeEmit("res 0,(iy+6),b", 0xfd, 0xcb, 0x06, 0x80);
    await testCodeEmit("res 0,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0x80);
    await testCodeEmit("res 0,(iy),c", 0xfd, 0xcb, 0x00, 0x81);
    await testCodeEmit("res 0,(iy+6),c", 0xfd, 0xcb, 0x06, 0x81);
    await testCodeEmit("res 0,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0x81);
    await testCodeEmit("res 0,(iy),d", 0xfd, 0xcb, 0x00, 0x82);
    await testCodeEmit("res 0,(iy+6),d", 0xfd, 0xcb, 0x06, 0x82);
    await testCodeEmit("res 0,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0x82);
    await testCodeEmit("res 0,(iy),e", 0xfd, 0xcb, 0x00, 0x83);
    await testCodeEmit("res 0,(iy+6),e", 0xfd, 0xcb, 0x06, 0x83);
    await testCodeEmit("res 0,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0x83);
    await testCodeEmit("res 0,(iy),h", 0xfd, 0xcb, 0x00, 0x84);
    await testCodeEmit("res 0,(iy+6),h", 0xfd, 0xcb, 0x06, 0x84);
    await testCodeEmit("res 0,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0x84);
    await testCodeEmit("res 0,(iy),l", 0xfd, 0xcb, 0x00, 0x85);
    await testCodeEmit("res 0,(iy+6),l", 0xfd, 0xcb, 0x06, 0x85);
    await testCodeEmit("res 0,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0x85);
    await testCodeEmit("res 0,(iy)", 0xfd, 0xcb, 0x00, 0x86);
    await testCodeEmit("res 0,(iy+6)", 0xfd, 0xcb, 0x06, 0x86);
    await testCodeEmit("res 0,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x86);
    await testCodeEmit("res 0,(iy),a", 0xfd, 0xcb, 0x00, 0x87);
    await testCodeEmit("res 0,(iy+6),a", 0xfd, 0xcb, 0x06, 0x87);
    await testCodeEmit("res 0,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0x87);

    await testCodeEmit("res 1,(iy),b", 0xfd, 0xcb, 0x00, 0x88);
    await testCodeEmit("res 1,(iy+6),b", 0xfd, 0xcb, 0x06, 0x88);
    await testCodeEmit("res 1,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0x88);
    await testCodeEmit("res 1,(iy),c", 0xfd, 0xcb, 0x00, 0x89);
    await testCodeEmit("res 1,(iy+6),c", 0xfd, 0xcb, 0x06, 0x89);
    await testCodeEmit("res 1,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0x89);
    await testCodeEmit("res 1,(iy),d", 0xfd, 0xcb, 0x00, 0x8a);
    await testCodeEmit("res 1,(iy+6),d", 0xfd, 0xcb, 0x06, 0x8a);
    await testCodeEmit("res 1,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0x8a);
    await testCodeEmit("res 1,(iy),e", 0xfd, 0xcb, 0x00, 0x8b);
    await testCodeEmit("res 1,(iy+6),e", 0xfd, 0xcb, 0x06, 0x8b);
    await testCodeEmit("res 1,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0x8b);
    await testCodeEmit("res 1,(iy),h", 0xfd, 0xcb, 0x00, 0x8c);
    await testCodeEmit("res 1,(iy+6),h", 0xfd, 0xcb, 0x06, 0x8c);
    await testCodeEmit("res 1,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0x8c);
    await testCodeEmit("res 1,(iy),l", 0xfd, 0xcb, 0x00, 0x8d);
    await testCodeEmit("res 1,(iy+6),l", 0xfd, 0xcb, 0x06, 0x8d);
    await testCodeEmit("res 1,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0x8d);
    await testCodeEmit("res 1,(iy)", 0xfd, 0xcb, 0x00, 0x8e);
    await testCodeEmit("res 1,(iy+6)", 0xfd, 0xcb, 0x06, 0x8e);
    await testCodeEmit("res 1,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x8e);
    await testCodeEmit("res 1,(iy),a", 0xfd, 0xcb, 0x00, 0x8f);
    await testCodeEmit("res 1,(iy+6),a", 0xfd, 0xcb, 0x06, 0x8f);
    await testCodeEmit("res 1,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0x8f);

    await testCodeEmit("res 2,(iy),b", 0xfd, 0xcb, 0x00, 0x90);
    await testCodeEmit("res 2,(iy+6),b", 0xfd, 0xcb, 0x06, 0x90);
    await testCodeEmit("res 2,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0x90);
    await testCodeEmit("res 2,(iy),c", 0xfd, 0xcb, 0x00, 0x91);
    await testCodeEmit("res 2,(iy+6),c", 0xfd, 0xcb, 0x06, 0x91);
    await testCodeEmit("res 2,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0x91);
    await testCodeEmit("res 2,(iy),d", 0xfd, 0xcb, 0x00, 0x92);
    await testCodeEmit("res 2,(iy+6),d", 0xfd, 0xcb, 0x06, 0x92);
    await testCodeEmit("res 2,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0x92);
    await testCodeEmit("res 2,(iy),e", 0xfd, 0xcb, 0x00, 0x93);
    await testCodeEmit("res 2,(iy+6),e", 0xfd, 0xcb, 0x06, 0x93);
    await testCodeEmit("res 2,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0x93);
    await testCodeEmit("res 2,(iy),h", 0xfd, 0xcb, 0x00, 0x94);
    await testCodeEmit("res 2,(iy+6),h", 0xfd, 0xcb, 0x06, 0x94);
    await testCodeEmit("res 2,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0x94);
    await testCodeEmit("res 2,(iy),l", 0xfd, 0xcb, 0x00, 0x95);
    await testCodeEmit("res 2,(iy+6),l", 0xfd, 0xcb, 0x06, 0x95);
    await testCodeEmit("res 2,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0x95);
    await testCodeEmit("res 2,(iy)", 0xfd, 0xcb, 0x00, 0x96);
    await testCodeEmit("res 2,(iy+6)", 0xfd, 0xcb, 0x06, 0x96);
    await testCodeEmit("res 2,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x96);
    await testCodeEmit("res 2,(iy),a", 0xfd, 0xcb, 0x00, 0x97);
    await testCodeEmit("res 2,(iy+6),a", 0xfd, 0xcb, 0x06, 0x97);
    await testCodeEmit("res 2,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0x97);

    await testCodeEmit("res 3,(iy),b", 0xfd, 0xcb, 0x00, 0x98);
    await testCodeEmit("res 3,(iy+6),b", 0xfd, 0xcb, 0x06, 0x98);
    await testCodeEmit("res 3,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0x98);
    await testCodeEmit("res 3,(iy),c", 0xfd, 0xcb, 0x00, 0x99);
    await testCodeEmit("res 3,(iy+6),c", 0xfd, 0xcb, 0x06, 0x99);
    await testCodeEmit("res 3,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0x99);
    await testCodeEmit("res 3,(iy),d", 0xfd, 0xcb, 0x00, 0x9a);
    await testCodeEmit("res 3,(iy+6),d", 0xfd, 0xcb, 0x06, 0x9a);
    await testCodeEmit("res 3,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0x9a);
    await testCodeEmit("res 3,(iy),e", 0xfd, 0xcb, 0x00, 0x9b);
    await testCodeEmit("res 3,(iy+6),e", 0xfd, 0xcb, 0x06, 0x9b);
    await testCodeEmit("res 3,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0x9b);
    await testCodeEmit("res 3,(iy),h", 0xfd, 0xcb, 0x00, 0x9c);
    await testCodeEmit("res 3,(iy+6),h", 0xfd, 0xcb, 0x06, 0x9c);
    await testCodeEmit("res 3,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0x9c);
    await testCodeEmit("res 3,(iy),l", 0xfd, 0xcb, 0x00, 0x9d);
    await testCodeEmit("res 3,(iy+6),l", 0xfd, 0xcb, 0x06, 0x9d);
    await testCodeEmit("res 3,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0x9d);
    await testCodeEmit("res 3,(iy)", 0xfd, 0xcb, 0x00, 0x9e);
    await testCodeEmit("res 3,(iy+6)", 0xfd, 0xcb, 0x06, 0x9e);
    await testCodeEmit("res 3,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0x9e);
    await testCodeEmit("res 3,(iy),a", 0xfd, 0xcb, 0x00, 0x9f);
    await testCodeEmit("res 3,(iy+6),a", 0xfd, 0xcb, 0x06, 0x9f);
    await testCodeEmit("res 3,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0x9f);

    await testCodeEmit("res 4,(iy),b", 0xfd, 0xcb, 0x00, 0xa0);
    await testCodeEmit("res 4,(iy+6),b", 0xfd, 0xcb, 0x06, 0xa0);
    await testCodeEmit("res 4,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xa0);
    await testCodeEmit("res 4,(iy),c", 0xfd, 0xcb, 0x00, 0xa1);
    await testCodeEmit("res 4,(iy+6),c", 0xfd, 0xcb, 0x06, 0xa1);
    await testCodeEmit("res 4,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xa1);
    await testCodeEmit("res 4,(iy),d", 0xfd, 0xcb, 0x00, 0xa2);
    await testCodeEmit("res 4,(iy+6),d", 0xfd, 0xcb, 0x06, 0xa2);
    await testCodeEmit("res 4,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xa2);
    await testCodeEmit("res 4,(iy),e", 0xfd, 0xcb, 0x00, 0xa3);
    await testCodeEmit("res 4,(iy+6),e", 0xfd, 0xcb, 0x06, 0xa3);
    await testCodeEmit("res 4,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xa3);
    await testCodeEmit("res 4,(iy),h", 0xfd, 0xcb, 0x00, 0xa4);
    await testCodeEmit("res 4,(iy+6),h", 0xfd, 0xcb, 0x06, 0xa4);
    await testCodeEmit("res 4,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xa4);
    await testCodeEmit("res 4,(iy),l", 0xfd, 0xcb, 0x00, 0xa5);
    await testCodeEmit("res 4,(iy+6),l", 0xfd, 0xcb, 0x06, 0xa5);
    await testCodeEmit("res 4,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xa5);
    await testCodeEmit("res 4,(iy)", 0xfd, 0xcb, 0x00, 0xa6);
    await testCodeEmit("res 4,(iy+6)", 0xfd, 0xcb, 0x06, 0xa6);
    await testCodeEmit("res 4,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xa6);
    await testCodeEmit("res 4,(iy),a", 0xfd, 0xcb, 0x00, 0xa7);
    await testCodeEmit("res 4,(iy+6),a", 0xfd, 0xcb, 0x06, 0xa7);
    await testCodeEmit("res 4,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xa7);

    await testCodeEmit("res 5,(iy),b", 0xfd, 0xcb, 0x00, 0xa8);
    await testCodeEmit("res 5,(iy+6),b", 0xfd, 0xcb, 0x06, 0xa8);
    await testCodeEmit("res 5,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xa8);
    await testCodeEmit("res 5,(iy),c", 0xfd, 0xcb, 0x00, 0xa9);
    await testCodeEmit("res 5,(iy+6),c", 0xfd, 0xcb, 0x06, 0xa9);
    await testCodeEmit("res 5,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xa9);
    await testCodeEmit("res 5,(iy),d", 0xfd, 0xcb, 0x00, 0xaa);
    await testCodeEmit("res 5,(iy+6),d", 0xfd, 0xcb, 0x06, 0xaa);
    await testCodeEmit("res 5,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xaa);
    await testCodeEmit("res 5,(iy),e", 0xfd, 0xcb, 0x00, 0xab);
    await testCodeEmit("res 5,(iy+6),e", 0xfd, 0xcb, 0x06, 0xab);
    await testCodeEmit("res 5,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xab);
    await testCodeEmit("res 5,(iy),h", 0xfd, 0xcb, 0x00, 0xac);
    await testCodeEmit("res 5,(iy+6),h", 0xfd, 0xcb, 0x06, 0xac);
    await testCodeEmit("res 5,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xac);
    await testCodeEmit("res 5,(iy),l", 0xfd, 0xcb, 0x00, 0xad);
    await testCodeEmit("res 5,(iy+6),l", 0xfd, 0xcb, 0x06, 0xad);
    await testCodeEmit("res 5,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xad);
    await testCodeEmit("res 5,(iy)", 0xfd, 0xcb, 0x00, 0xae);
    await testCodeEmit("res 5,(iy+6)", 0xfd, 0xcb, 0x06, 0xae);
    await testCodeEmit("res 5,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xae);
    await testCodeEmit("res 5,(iy),a", 0xfd, 0xcb, 0x00, 0xaf);
    await testCodeEmit("res 5,(iy+6),a", 0xfd, 0xcb, 0x06, 0xaf);
    await testCodeEmit("res 5,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xaf);

    await testCodeEmit("res 6,(iy),b", 0xfd, 0xcb, 0x00, 0xb0);
    await testCodeEmit("res 6,(iy+6),b", 0xfd, 0xcb, 0x06, 0xb0);
    await testCodeEmit("res 6,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xb0);
    await testCodeEmit("res 6,(iy),c", 0xfd, 0xcb, 0x00, 0xb1);
    await testCodeEmit("res 6,(iy+6),c", 0xfd, 0xcb, 0x06, 0xb1);
    await testCodeEmit("res 6,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xb1);
    await testCodeEmit("res 6,(iy),d", 0xfd, 0xcb, 0x00, 0xb2);
    await testCodeEmit("res 6,(iy+6),d", 0xfd, 0xcb, 0x06, 0xb2);
    await testCodeEmit("res 6,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xb2);
    await testCodeEmit("res 6,(iy),e", 0xfd, 0xcb, 0x00, 0xb3);
    await testCodeEmit("res 6,(iy+6),e", 0xfd, 0xcb, 0x06, 0xb3);
    await testCodeEmit("res 6,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xb3);
    await testCodeEmit("res 6,(iy),h", 0xfd, 0xcb, 0x00, 0xb4);
    await testCodeEmit("res 6,(iy+6),h", 0xfd, 0xcb, 0x06, 0xb4);
    await testCodeEmit("res 6,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xb4);
    await testCodeEmit("res 6,(iy),l", 0xfd, 0xcb, 0x00, 0xb5);
    await testCodeEmit("res 6,(iy+6),l", 0xfd, 0xcb, 0x06, 0xb5);
    await testCodeEmit("res 6,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xb5);
    await testCodeEmit("res 6,(iy)", 0xfd, 0xcb, 0x00, 0xb6);
    await testCodeEmit("res 6,(iy+6)", 0xfd, 0xcb, 0x06, 0xb6);
    await testCodeEmit("res 6,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xb6);
    await testCodeEmit("res 6,(iy),a", 0xfd, 0xcb, 0x00, 0xb7);
    await testCodeEmit("res 6,(iy+6),a", 0xfd, 0xcb, 0x06, 0xb7);
    await testCodeEmit("res 6,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xb7);

    await testCodeEmit("res 7,(iy),b", 0xfd, 0xcb, 0x00, 0xb8);
    await testCodeEmit("res 7,(iy+6),b", 0xfd, 0xcb, 0x06, 0xb8);
    await testCodeEmit("res 7,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xb8);
    await testCodeEmit("res 7,(iy),c", 0xfd, 0xcb, 0x00, 0xb9);
    await testCodeEmit("res 7,(iy+6),c", 0xfd, 0xcb, 0x06, 0xb9);
    await testCodeEmit("res 7,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xb9);
    await testCodeEmit("res 7,(iy),d", 0xfd, 0xcb, 0x00, 0xba);
    await testCodeEmit("res 7,(iy+6),d", 0xfd, 0xcb, 0x06, 0xba);
    await testCodeEmit("res 7,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xba);
    await testCodeEmit("res 7,(iy),e", 0xfd, 0xcb, 0x00, 0xbb);
    await testCodeEmit("res 7,(iy+6),e", 0xfd, 0xcb, 0x06, 0xbb);
    await testCodeEmit("res 7,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xbb);
    await testCodeEmit("res 7,(iy),h", 0xfd, 0xcb, 0x00, 0xbc);
    await testCodeEmit("res 7,(iy+6),h", 0xfd, 0xcb, 0x06, 0xbc);
    await testCodeEmit("res 7,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xbc);
    await testCodeEmit("res 7,(iy),l", 0xfd, 0xcb, 0x00, 0xbd);
    await testCodeEmit("res 7,(iy+6),l", 0xfd, 0xcb, 0x06, 0xbd);
    await testCodeEmit("res 7,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xbd);
    await testCodeEmit("res 7,(iy)", 0xfd, 0xcb, 0x00, 0xbe);
    await testCodeEmit("res 7,(iy+6)", 0xfd, 0xcb, 0x06, 0xbe);
    await testCodeEmit("res 7,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xbe);
    await testCodeEmit("res 7,(iy),a", 0xfd, 0xcb, 0x00, 0xbf);
    await testCodeEmit("res 7,(iy+6),a", 0xfd, 0xcb, 0x06, 0xbf);
    await testCodeEmit("res 7,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xbf);
  });

  it("set", async () => {
    await testCodeEmit("set 0,b", 0xcb, 0xc0);
    await testCodeEmit("set 0,c", 0xcb, 0xc1);
    await testCodeEmit("set 0,d", 0xcb, 0xc2);
    await testCodeEmit("set 0,e", 0xcb, 0xc3);
    await testCodeEmit("set 0,h", 0xcb, 0xc4);
    await testCodeEmit("set 0,l", 0xcb, 0xc5);
    await testCodeEmit("set 0,(hl)", 0xcb, 0xc6);
    await testCodeEmit("set 0,a", 0xcb, 0xc7);

    await testCodeEmit("set 1,b", 0xcb, 0xc8);
    await testCodeEmit("set 1,c", 0xcb, 0xc9);
    await testCodeEmit("set 1,d", 0xcb, 0xca);
    await testCodeEmit("set 1,e", 0xcb, 0xcb);
    await testCodeEmit("set 1,h", 0xcb, 0xcc);
    await testCodeEmit("set 1,l", 0xcb, 0xcd);
    await testCodeEmit("set 1,(hl)", 0xcb, 0xce);
    await testCodeEmit("set 1,a", 0xcb, 0xcf);

    await testCodeEmit("set 2,b", 0xcb, 0xd0);
    await testCodeEmit("set 2,c", 0xcb, 0xd1);
    await testCodeEmit("set 2,d", 0xcb, 0xd2);
    await testCodeEmit("set 2,e", 0xcb, 0xd3);
    await testCodeEmit("set 2,h", 0xcb, 0xd4);
    await testCodeEmit("set 2,l", 0xcb, 0xd5);
    await testCodeEmit("set 2,(hl)", 0xcb, 0xd6);
    await testCodeEmit("set 2,a", 0xcb, 0xd7);

    await testCodeEmit("set 3,b", 0xcb, 0xd8);
    await testCodeEmit("set 3,c", 0xcb, 0xd9);
    await testCodeEmit("set 3,d", 0xcb, 0xda);
    await testCodeEmit("set 3,e", 0xcb, 0xdb);
    await testCodeEmit("set 3,h", 0xcb, 0xdc);
    await testCodeEmit("set 3,l", 0xcb, 0xdd);
    await testCodeEmit("set 3,(hl)", 0xcb, 0xde);
    await testCodeEmit("set 3,a", 0xcb, 0xdf);

    await testCodeEmit("set 4,b", 0xcb, 0xe0);
    await testCodeEmit("set 4,c", 0xcb, 0xe1);
    await testCodeEmit("set 4,d", 0xcb, 0xe2);
    await testCodeEmit("set 4,e", 0xcb, 0xe3);
    await testCodeEmit("set 4,h", 0xcb, 0xe4);
    await testCodeEmit("set 4,l", 0xcb, 0xe5);
    await testCodeEmit("set 4,(hl)", 0xcb, 0xe6);
    await testCodeEmit("set 4,a", 0xcb, 0xe7);

    await testCodeEmit("set 5,b", 0xcb, 0xe8);
    await testCodeEmit("set 5,c", 0xcb, 0xe9);
    await testCodeEmit("set 5,d", 0xcb, 0xea);
    await testCodeEmit("set 5,e", 0xcb, 0xeb);
    await testCodeEmit("set 5,h", 0xcb, 0xec);
    await testCodeEmit("set 5,l", 0xcb, 0xed);
    await testCodeEmit("set 5,(hl)", 0xcb, 0xee);
    await testCodeEmit("set 5,a", 0xcb, 0xef);

    await testCodeEmit("set 6,b", 0xcb, 0xf0);
    await testCodeEmit("set 6,c", 0xcb, 0xf1);
    await testCodeEmit("set 6,d", 0xcb, 0xf2);
    await testCodeEmit("set 6,e", 0xcb, 0xf3);
    await testCodeEmit("set 6,h", 0xcb, 0xf4);
    await testCodeEmit("set 6,l", 0xcb, 0xf5);
    await testCodeEmit("set 6,(hl)", 0xcb, 0xf6);
    await testCodeEmit("set 6,a", 0xcb, 0xf7);

    await testCodeEmit("set 7,b", 0xcb, 0xf8);
    await testCodeEmit("set 7,c", 0xcb, 0xf9);
    await testCodeEmit("set 7,d", 0xcb, 0xfa);
    await testCodeEmit("set 7,e", 0xcb, 0xfb);
    await testCodeEmit("set 7,h", 0xcb, 0xfc);
    await testCodeEmit("set 7,l", 0xcb, 0xfd);
    await testCodeEmit("set 7,(hl)", 0xcb, 0xfe);
    await testCodeEmit("set 7,a", 0xcb, 0xff);
  });

  it("set: fails with invalid operand", async () => {
    await codeRaisesError("set -1,b", "Z0407");
    await codeRaisesError("set 8,b", "Z0407");
  });

  it("set: indexed instructions", async () => {
    await testCodeEmit("set 0,(ix),b", 0xdd, 0xcb, 0x00, 0xc0);
    await testCodeEmit("set 0,(ix+6),b", 0xdd, 0xcb, 0x06, 0xc0);
    await testCodeEmit("set 0,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xc0);
    await testCodeEmit("set 0,(ix),c", 0xdd, 0xcb, 0x00, 0xc1);
    await testCodeEmit("set 0,(ix+6),c", 0xdd, 0xcb, 0x06, 0xc1);
    await testCodeEmit("set 0,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xc1);
    await testCodeEmit("set 0,(ix),d", 0xdd, 0xcb, 0x00, 0xc2);
    await testCodeEmit("set 0,(ix+6),d", 0xdd, 0xcb, 0x06, 0xc2);
    await testCodeEmit("set 0,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xc2);
    await testCodeEmit("set 0,(ix),e", 0xdd, 0xcb, 0x00, 0xc3);
    await testCodeEmit("set 0,(ix+6),e", 0xdd, 0xcb, 0x06, 0xc3);
    await testCodeEmit("set 0,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xc3);
    await testCodeEmit("set 0,(ix),h", 0xdd, 0xcb, 0x00, 0xc4);
    await testCodeEmit("set 0,(ix+6),h", 0xdd, 0xcb, 0x06, 0xc4);
    await testCodeEmit("set 0,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xc4);
    await testCodeEmit("set 0,(ix),l", 0xdd, 0xcb, 0x00, 0xc5);
    await testCodeEmit("set 0,(ix+6),l", 0xdd, 0xcb, 0x06, 0xc5);
    await testCodeEmit("set 0,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xc5);
    await testCodeEmit("set 0,(ix)", 0xdd, 0xcb, 0x00, 0xc6);
    await testCodeEmit("set 0,(ix+6)", 0xdd, 0xcb, 0x06, 0xc6);
    await testCodeEmit("set 0,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xc6);
    await testCodeEmit("set 0,(ix),a", 0xdd, 0xcb, 0x00, 0xc7);
    await testCodeEmit("set 0,(ix+6),a", 0xdd, 0xcb, 0x06, 0xc7);
    await testCodeEmit("set 0,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xc7);

    await testCodeEmit("set 1,(ix),b", 0xdd, 0xcb, 0x00, 0xc8);
    await testCodeEmit("set 1,(ix+6),b", 0xdd, 0xcb, 0x06, 0xc8);
    await testCodeEmit("set 1,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xc8);
    await testCodeEmit("set 1,(ix),c", 0xdd, 0xcb, 0x00, 0xc9);
    await testCodeEmit("set 1,(ix+6),c", 0xdd, 0xcb, 0x06, 0xc9);
    await testCodeEmit("set 1,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xc9);
    await testCodeEmit("set 1,(ix),d", 0xdd, 0xcb, 0x00, 0xca);
    await testCodeEmit("set 1,(ix+6),d", 0xdd, 0xcb, 0x06, 0xca);
    await testCodeEmit("set 1,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xca);
    await testCodeEmit("set 1,(ix),e", 0xdd, 0xcb, 0x00, 0xcb);
    await testCodeEmit("set 1,(ix+6),e", 0xdd, 0xcb, 0x06, 0xcb);
    await testCodeEmit("set 1,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xcb);
    await testCodeEmit("set 1,(ix),h", 0xdd, 0xcb, 0x00, 0xcc);
    await testCodeEmit("set 1,(ix+6),h", 0xdd, 0xcb, 0x06, 0xcc);
    await testCodeEmit("set 1,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xcc);
    await testCodeEmit("set 1,(ix),l", 0xdd, 0xcb, 0x00, 0xcd);
    await testCodeEmit("set 1,(ix+6),l", 0xdd, 0xcb, 0x06, 0xcd);
    await testCodeEmit("set 1,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xcd);
    await testCodeEmit("set 1,(ix)", 0xdd, 0xcb, 0x00, 0xce);
    await testCodeEmit("set 1,(ix+6)", 0xdd, 0xcb, 0x06, 0xce);
    await testCodeEmit("set 1,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xce);
    await testCodeEmit("set 1,(ix),a", 0xdd, 0xcb, 0x00, 0xcf);
    await testCodeEmit("set 1,(ix+6),a", 0xdd, 0xcb, 0x06, 0xcf);
    await testCodeEmit("set 1,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xcf);

    await testCodeEmit("set 2,(ix),b", 0xdd, 0xcb, 0x00, 0xd0);
    await testCodeEmit("set 2,(ix+6),b", 0xdd, 0xcb, 0x06, 0xd0);
    await testCodeEmit("set 2,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xd0);
    await testCodeEmit("set 2,(ix),c", 0xdd, 0xcb, 0x00, 0xd1);
    await testCodeEmit("set 2,(ix+6),c", 0xdd, 0xcb, 0x06, 0xd1);
    await testCodeEmit("set 2,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xd1);
    await testCodeEmit("set 2,(ix),d", 0xdd, 0xcb, 0x00, 0xd2);
    await testCodeEmit("set 2,(ix+6),d", 0xdd, 0xcb, 0x06, 0xd2);
    await testCodeEmit("set 2,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xd2);
    await testCodeEmit("set 2,(ix),e", 0xdd, 0xcb, 0x00, 0xd3);
    await testCodeEmit("set 2,(ix+6),e", 0xdd, 0xcb, 0x06, 0xd3);
    await testCodeEmit("set 2,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xd3);
    await testCodeEmit("set 2,(ix),h", 0xdd, 0xcb, 0x00, 0xd4);
    await testCodeEmit("set 2,(ix+6),h", 0xdd, 0xcb, 0x06, 0xd4);
    await testCodeEmit("set 2,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xd4);
    await testCodeEmit("set 2,(ix),l", 0xdd, 0xcb, 0x00, 0xd5);
    await testCodeEmit("set 2,(ix+6),l", 0xdd, 0xcb, 0x06, 0xd5);
    await testCodeEmit("set 2,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xd5);
    await testCodeEmit("set 2,(ix)", 0xdd, 0xcb, 0x00, 0xd6);
    await testCodeEmit("set 2,(ix+6)", 0xdd, 0xcb, 0x06, 0xd6);
    await testCodeEmit("set 2,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xd6);
    await testCodeEmit("set 2,(ix),a", 0xdd, 0xcb, 0x00, 0xd7);
    await testCodeEmit("set 2,(ix+6),a", 0xdd, 0xcb, 0x06, 0xd7);
    await testCodeEmit("set 2,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xd7);

    await testCodeEmit("set 3,(ix),b", 0xdd, 0xcb, 0x00, 0xd8);
    await testCodeEmit("set 3,(ix+6),b", 0xdd, 0xcb, 0x06, 0xd8);
    await testCodeEmit("set 3,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xd8);
    await testCodeEmit("set 3,(ix),c", 0xdd, 0xcb, 0x00, 0xd9);
    await testCodeEmit("set 3,(ix+6),c", 0xdd, 0xcb, 0x06, 0xd9);
    await testCodeEmit("set 3,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xd9);
    await testCodeEmit("set 3,(ix),d", 0xdd, 0xcb, 0x00, 0xda);
    await testCodeEmit("set 3,(ix+6),d", 0xdd, 0xcb, 0x06, 0xda);
    await testCodeEmit("set 3,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xda);
    await testCodeEmit("set 3,(ix),e", 0xdd, 0xcb, 0x00, 0xdb);
    await testCodeEmit("set 3,(ix+6),e", 0xdd, 0xcb, 0x06, 0xdb);
    await testCodeEmit("set 3,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xdb);
    await testCodeEmit("set 3,(ix),h", 0xdd, 0xcb, 0x00, 0xdc);
    await testCodeEmit("set 3,(ix+6),h", 0xdd, 0xcb, 0x06, 0xdc);
    await testCodeEmit("set 3,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xdc);
    await testCodeEmit("set 3,(ix),l", 0xdd, 0xcb, 0x00, 0xdd);
    await testCodeEmit("set 3,(ix+6),l", 0xdd, 0xcb, 0x06, 0xdd);
    await testCodeEmit("set 3,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xdd);
    await testCodeEmit("set 3,(ix)", 0xdd, 0xcb, 0x00, 0xde);
    await testCodeEmit("set 3,(ix+6)", 0xdd, 0xcb, 0x06, 0xde);
    await testCodeEmit("set 3,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xde);
    await testCodeEmit("set 3,(ix),a", 0xdd, 0xcb, 0x00, 0xdf);
    await testCodeEmit("set 3,(ix+6),a", 0xdd, 0xcb, 0x06, 0xdf);
    await testCodeEmit("set 3,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xdf);

    await testCodeEmit("set 4,(ix),b", 0xdd, 0xcb, 0x00, 0xe0);
    await testCodeEmit("set 4,(ix+6),b", 0xdd, 0xcb, 0x06, 0xe0);
    await testCodeEmit("set 4,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xe0);
    await testCodeEmit("set 4,(ix),c", 0xdd, 0xcb, 0x00, 0xe1);
    await testCodeEmit("set 4,(ix+6),c", 0xdd, 0xcb, 0x06, 0xe1);
    await testCodeEmit("set 4,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xe1);
    await testCodeEmit("set 4,(ix),d", 0xdd, 0xcb, 0x00, 0xe2);
    await testCodeEmit("set 4,(ix+6),d", 0xdd, 0xcb, 0x06, 0xe2);
    await testCodeEmit("set 4,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xe2);
    await testCodeEmit("set 4,(ix),e", 0xdd, 0xcb, 0x00, 0xe3);
    await testCodeEmit("set 4,(ix+6),e", 0xdd, 0xcb, 0x06, 0xe3);
    await testCodeEmit("set 4,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xe3);
    await testCodeEmit("set 4,(ix),h", 0xdd, 0xcb, 0x00, 0xe4);
    await testCodeEmit("set 4,(ix+6),h", 0xdd, 0xcb, 0x06, 0xe4);
    await testCodeEmit("set 4,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xe4);
    await testCodeEmit("set 4,(ix),l", 0xdd, 0xcb, 0x00, 0xe5);
    await testCodeEmit("set 4,(ix+6),l", 0xdd, 0xcb, 0x06, 0xe5);
    await testCodeEmit("set 4,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xe5);
    await testCodeEmit("set 4,(ix)", 0xdd, 0xcb, 0x00, 0xe6);
    await testCodeEmit("set 4,(ix+6)", 0xdd, 0xcb, 0x06, 0xe6);
    await testCodeEmit("set 4,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xe6);
    await testCodeEmit("set 4,(ix),a", 0xdd, 0xcb, 0x00, 0xe7);
    await testCodeEmit("set 4,(ix+6),a", 0xdd, 0xcb, 0x06, 0xe7);
    await testCodeEmit("set 4,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xe7);

    await testCodeEmit("set 5,(ix),b", 0xdd, 0xcb, 0x00, 0xe8);
    await testCodeEmit("set 5,(ix+6),b", 0xdd, 0xcb, 0x06, 0xe8);
    await testCodeEmit("set 5,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xe8);
    await testCodeEmit("set 5,(ix),c", 0xdd, 0xcb, 0x00, 0xe9);
    await testCodeEmit("set 5,(ix+6),c", 0xdd, 0xcb, 0x06, 0xe9);
    await testCodeEmit("set 5,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xe9);
    await testCodeEmit("set 5,(ix),d", 0xdd, 0xcb, 0x00, 0xea);
    await testCodeEmit("set 5,(ix+6),d", 0xdd, 0xcb, 0x06, 0xea);
    await testCodeEmit("set 5,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xea);
    await testCodeEmit("set 5,(ix),e", 0xdd, 0xcb, 0x00, 0xeb);
    await testCodeEmit("set 5,(ix+6),e", 0xdd, 0xcb, 0x06, 0xeb);
    await testCodeEmit("set 5,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xeb);
    await testCodeEmit("set 5,(ix),h", 0xdd, 0xcb, 0x00, 0xec);
    await testCodeEmit("set 5,(ix+6),h", 0xdd, 0xcb, 0x06, 0xec);
    await testCodeEmit("set 5,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xec);
    await testCodeEmit("set 5,(ix),l", 0xdd, 0xcb, 0x00, 0xed);
    await testCodeEmit("set 5,(ix+6),l", 0xdd, 0xcb, 0x06, 0xed);
    await testCodeEmit("set 5,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xed);
    await testCodeEmit("set 5,(ix)", 0xdd, 0xcb, 0x00, 0xee);
    await testCodeEmit("set 5,(ix+6)", 0xdd, 0xcb, 0x06, 0xee);
    await testCodeEmit("set 5,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xee);
    await testCodeEmit("set 5,(ix),a", 0xdd, 0xcb, 0x00, 0xef);
    await testCodeEmit("set 5,(ix+6),a", 0xdd, 0xcb, 0x06, 0xef);
    await testCodeEmit("set 5,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xef);

    await testCodeEmit("set 6,(ix),b", 0xdd, 0xcb, 0x00, 0xf0);
    await testCodeEmit("set 6,(ix+6),b", 0xdd, 0xcb, 0x06, 0xf0);
    await testCodeEmit("set 6,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xf0);
    await testCodeEmit("set 6,(ix),c", 0xdd, 0xcb, 0x00, 0xf1);
    await testCodeEmit("set 6,(ix+6),c", 0xdd, 0xcb, 0x06, 0xf1);
    await testCodeEmit("set 6,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xf1);
    await testCodeEmit("set 6,(ix),d", 0xdd, 0xcb, 0x00, 0xf2);
    await testCodeEmit("set 6,(ix+6),d", 0xdd, 0xcb, 0x06, 0xf2);
    await testCodeEmit("set 6,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xf2);
    await testCodeEmit("set 6,(ix),e", 0xdd, 0xcb, 0x00, 0xf3);
    await testCodeEmit("set 6,(ix+6),e", 0xdd, 0xcb, 0x06, 0xf3);
    await testCodeEmit("set 6,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xf3);
    await testCodeEmit("set 6,(ix),h", 0xdd, 0xcb, 0x00, 0xf4);
    await testCodeEmit("set 6,(ix+6),h", 0xdd, 0xcb, 0x06, 0xf4);
    await testCodeEmit("set 6,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xf4);
    await testCodeEmit("set 6,(ix),l", 0xdd, 0xcb, 0x00, 0xf5);
    await testCodeEmit("set 6,(ix+6),l", 0xdd, 0xcb, 0x06, 0xf5);
    await testCodeEmit("set 6,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xf5);
    await testCodeEmit("set 6,(ix)", 0xdd, 0xcb, 0x00, 0xf6);
    await testCodeEmit("set 6,(ix+6)", 0xdd, 0xcb, 0x06, 0xf6);
    await testCodeEmit("set 6,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xf6);
    await testCodeEmit("set 6,(ix),a", 0xdd, 0xcb, 0x00, 0xf7);
    await testCodeEmit("set 6,(ix+6),a", 0xdd, 0xcb, 0x06, 0xf7);
    await testCodeEmit("set 6,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xf7);

    await testCodeEmit("set 7,(ix),b", 0xdd, 0xcb, 0x00, 0xf8);
    await testCodeEmit("set 7,(ix+6),b", 0xdd, 0xcb, 0x06, 0xf8);
    await testCodeEmit("set 7,(ix-#0c),b", 0xdd, 0xcb, 0xf4, 0xf8);
    await testCodeEmit("set 7,(ix),c", 0xdd, 0xcb, 0x00, 0xf9);
    await testCodeEmit("set 7,(ix+6),c", 0xdd, 0xcb, 0x06, 0xf9);
    await testCodeEmit("set 7,(ix-#0c),c", 0xdd, 0xcb, 0xf4, 0xf9);
    await testCodeEmit("set 7,(ix),d", 0xdd, 0xcb, 0x00, 0xfa);
    await testCodeEmit("set 7,(ix+6),d", 0xdd, 0xcb, 0x06, 0xfa);
    await testCodeEmit("set 7,(ix-#0c),d", 0xdd, 0xcb, 0xf4, 0xfa);
    await testCodeEmit("set 7,(ix),e", 0xdd, 0xcb, 0x00, 0xfb);
    await testCodeEmit("set 7,(ix+6),e", 0xdd, 0xcb, 0x06, 0xfb);
    await testCodeEmit("set 7,(ix-#0c),e", 0xdd, 0xcb, 0xf4, 0xfb);
    await testCodeEmit("set 7,(ix),h", 0xdd, 0xcb, 0x00, 0xfc);
    await testCodeEmit("set 7,(ix+6),h", 0xdd, 0xcb, 0x06, 0xfc);
    await testCodeEmit("set 7,(ix-#0c),h", 0xdd, 0xcb, 0xf4, 0xfc);
    await testCodeEmit("set 7,(ix),l", 0xdd, 0xcb, 0x00, 0xfd);
    await testCodeEmit("set 7,(ix+6),l", 0xdd, 0xcb, 0x06, 0xfd);
    await testCodeEmit("set 7,(ix-#0c),l", 0xdd, 0xcb, 0xf4, 0xfd);
    await testCodeEmit("set 7,(ix)", 0xdd, 0xcb, 0x00, 0xfe);
    await testCodeEmit("set 7,(ix+6)", 0xdd, 0xcb, 0x06, 0xfe);
    await testCodeEmit("set 7,(ix-#0c)", 0xdd, 0xcb, 0xf4, 0xfe);
    await testCodeEmit("set 7,(ix),a", 0xdd, 0xcb, 0x00, 0xff);
    await testCodeEmit("set 7,(ix+6),a", 0xdd, 0xcb, 0x06, 0xff);
    await testCodeEmit("set 7,(ix-#0c),a", 0xdd, 0xcb, 0xf4, 0xff);

    await testCodeEmit("set 0,(iy),b", 0xfd, 0xcb, 0x00, 0xc0);
    await testCodeEmit("set 0,(iy+6),b", 0xfd, 0xcb, 0x06, 0xc0);
    await testCodeEmit("set 0,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xc0);
    await testCodeEmit("set 0,(iy),c", 0xfd, 0xcb, 0x00, 0xc1);
    await testCodeEmit("set 0,(iy+6),c", 0xfd, 0xcb, 0x06, 0xc1);
    await testCodeEmit("set 0,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xc1);
    await testCodeEmit("set 0,(iy),d", 0xfd, 0xcb, 0x00, 0xc2);
    await testCodeEmit("set 0,(iy+6),d", 0xfd, 0xcb, 0x06, 0xc2);
    await testCodeEmit("set 0,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xc2);
    await testCodeEmit("set 0,(iy),e", 0xfd, 0xcb, 0x00, 0xc3);
    await testCodeEmit("set 0,(iy+6),e", 0xfd, 0xcb, 0x06, 0xc3);
    await testCodeEmit("set 0,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xc3);
    await testCodeEmit("set 0,(iy),h", 0xfd, 0xcb, 0x00, 0xc4);
    await testCodeEmit("set 0,(iy+6),h", 0xfd, 0xcb, 0x06, 0xc4);
    await testCodeEmit("set 0,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xc4);
    await testCodeEmit("set 0,(iy),l", 0xfd, 0xcb, 0x00, 0xc5);
    await testCodeEmit("set 0,(iy+6),l", 0xfd, 0xcb, 0x06, 0xc5);
    await testCodeEmit("set 0,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xc5);
    await testCodeEmit("set 0,(iy)", 0xfd, 0xcb, 0x00, 0xc6);
    await testCodeEmit("set 0,(iy+6)", 0xfd, 0xcb, 0x06, 0xc6);
    await testCodeEmit("set 0,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xc6);
    await testCodeEmit("set 0,(iy),a", 0xfd, 0xcb, 0x00, 0xc7);
    await testCodeEmit("set 0,(iy+6),a", 0xfd, 0xcb, 0x06, 0xc7);
    await testCodeEmit("set 0,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xc7);

    await testCodeEmit("set 1,(iy),b", 0xfd, 0xcb, 0x00, 0xc8);
    await testCodeEmit("set 1,(iy+6),b", 0xfd, 0xcb, 0x06, 0xc8);
    await testCodeEmit("set 1,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xc8);
    await testCodeEmit("set 1,(iy),c", 0xfd, 0xcb, 0x00, 0xc9);
    await testCodeEmit("set 1,(iy+6),c", 0xfd, 0xcb, 0x06, 0xc9);
    await testCodeEmit("set 1,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xc9);
    await testCodeEmit("set 1,(iy),d", 0xfd, 0xcb, 0x00, 0xca);
    await testCodeEmit("set 1,(iy+6),d", 0xfd, 0xcb, 0x06, 0xca);
    await testCodeEmit("set 1,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xca);
    await testCodeEmit("set 1,(iy),e", 0xfd, 0xcb, 0x00, 0xcb);
    await testCodeEmit("set 1,(iy+6),e", 0xfd, 0xcb, 0x06, 0xcb);
    await testCodeEmit("set 1,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xcb);
    await testCodeEmit("set 1,(iy),h", 0xfd, 0xcb, 0x00, 0xcc);
    await testCodeEmit("set 1,(iy+6),h", 0xfd, 0xcb, 0x06, 0xcc);
    await testCodeEmit("set 1,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xcc);
    await testCodeEmit("set 1,(iy),l", 0xfd, 0xcb, 0x00, 0xcd);
    await testCodeEmit("set 1,(iy+6),l", 0xfd, 0xcb, 0x06, 0xcd);
    await testCodeEmit("set 1,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xcd);
    await testCodeEmit("set 1,(iy)", 0xfd, 0xcb, 0x00, 0xce);
    await testCodeEmit("set 1,(iy+6)", 0xfd, 0xcb, 0x06, 0xce);
    await testCodeEmit("set 1,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xce);
    await testCodeEmit("set 1,(iy),a", 0xfd, 0xcb, 0x00, 0xcf);
    await testCodeEmit("set 1,(iy+6),a", 0xfd, 0xcb, 0x06, 0xcf);
    await testCodeEmit("set 1,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xcf);

    await testCodeEmit("set 2,(iy),b", 0xfd, 0xcb, 0x00, 0xd0);
    await testCodeEmit("set 2,(iy+6),b", 0xfd, 0xcb, 0x06, 0xd0);
    await testCodeEmit("set 2,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xd0);
    await testCodeEmit("set 2,(iy),c", 0xfd, 0xcb, 0x00, 0xd1);
    await testCodeEmit("set 2,(iy+6),c", 0xfd, 0xcb, 0x06, 0xd1);
    await testCodeEmit("set 2,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xd1);
    await testCodeEmit("set 2,(iy),d", 0xfd, 0xcb, 0x00, 0xd2);
    await testCodeEmit("set 2,(iy+6),d", 0xfd, 0xcb, 0x06, 0xd2);
    await testCodeEmit("set 2,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xd2);
    await testCodeEmit("set 2,(iy),e", 0xfd, 0xcb, 0x00, 0xd3);
    await testCodeEmit("set 2,(iy+6),e", 0xfd, 0xcb, 0x06, 0xd3);
    await testCodeEmit("set 2,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xd3);
    await testCodeEmit("set 2,(iy),h", 0xfd, 0xcb, 0x00, 0xd4);
    await testCodeEmit("set 2,(iy+6),h", 0xfd, 0xcb, 0x06, 0xd4);
    await testCodeEmit("set 2,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xd4);
    await testCodeEmit("set 2,(iy),l", 0xfd, 0xcb, 0x00, 0xd5);
    await testCodeEmit("set 2,(iy+6),l", 0xfd, 0xcb, 0x06, 0xd5);
    await testCodeEmit("set 2,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xd5);
    await testCodeEmit("set 2,(iy)", 0xfd, 0xcb, 0x00, 0xd6);
    await testCodeEmit("set 2,(iy+6)", 0xfd, 0xcb, 0x06, 0xd6);
    await testCodeEmit("set 2,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xd6);
    await testCodeEmit("set 2,(iy),a", 0xfd, 0xcb, 0x00, 0xd7);
    await testCodeEmit("set 2,(iy+6),a", 0xfd, 0xcb, 0x06, 0xd7);
    await testCodeEmit("set 2,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xd7);

    await testCodeEmit("set 3,(iy),b", 0xfd, 0xcb, 0x00, 0xd8);
    await testCodeEmit("set 3,(iy+6),b", 0xfd, 0xcb, 0x06, 0xd8);
    await testCodeEmit("set 3,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xd8);
    await testCodeEmit("set 3,(iy),c", 0xfd, 0xcb, 0x00, 0xd9);
    await testCodeEmit("set 3,(iy+6),c", 0xfd, 0xcb, 0x06, 0xd9);
    await testCodeEmit("set 3,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xd9);
    await testCodeEmit("set 3,(iy),d", 0xfd, 0xcb, 0x00, 0xda);
    await testCodeEmit("set 3,(iy+6),d", 0xfd, 0xcb, 0x06, 0xda);
    await testCodeEmit("set 3,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xda);
    await testCodeEmit("set 3,(iy),e", 0xfd, 0xcb, 0x00, 0xdb);
    await testCodeEmit("set 3,(iy+6),e", 0xfd, 0xcb, 0x06, 0xdb);
    await testCodeEmit("set 3,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xdb);
    await testCodeEmit("set 3,(iy),h", 0xfd, 0xcb, 0x00, 0xdc);
    await testCodeEmit("set 3,(iy+6),h", 0xfd, 0xcb, 0x06, 0xdc);
    await testCodeEmit("set 3,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xdc);
    await testCodeEmit("set 3,(iy),l", 0xfd, 0xcb, 0x00, 0xdd);
    await testCodeEmit("set 3,(iy+6),l", 0xfd, 0xcb, 0x06, 0xdd);
    await testCodeEmit("set 3,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xdd);
    await testCodeEmit("set 3,(iy)", 0xfd, 0xcb, 0x00, 0xde);
    await testCodeEmit("set 3,(iy+6)", 0xfd, 0xcb, 0x06, 0xde);
    await testCodeEmit("set 3,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xde);
    await testCodeEmit("set 3,(iy),a", 0xfd, 0xcb, 0x00, 0xdf);
    await testCodeEmit("set 3,(iy+6),a", 0xfd, 0xcb, 0x06, 0xdf);
    await testCodeEmit("set 3,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xdf);

    await testCodeEmit("set 4,(iy),b", 0xfd, 0xcb, 0x00, 0xe0);
    await testCodeEmit("set 4,(iy+6),b", 0xfd, 0xcb, 0x06, 0xe0);
    await testCodeEmit("set 4,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xe0);
    await testCodeEmit("set 4,(iy),c", 0xfd, 0xcb, 0x00, 0xe1);
    await testCodeEmit("set 4,(iy+6),c", 0xfd, 0xcb, 0x06, 0xe1);
    await testCodeEmit("set 4,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xe1);
    await testCodeEmit("set 4,(iy),d", 0xfd, 0xcb, 0x00, 0xe2);
    await testCodeEmit("set 4,(iy+6),d", 0xfd, 0xcb, 0x06, 0xe2);
    await testCodeEmit("set 4,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xe2);
    await testCodeEmit("set 4,(iy),e", 0xfd, 0xcb, 0x00, 0xe3);
    await testCodeEmit("set 4,(iy+6),e", 0xfd, 0xcb, 0x06, 0xe3);
    await testCodeEmit("set 4,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xe3);
    await testCodeEmit("set 4,(iy),h", 0xfd, 0xcb, 0x00, 0xe4);
    await testCodeEmit("set 4,(iy+6),h", 0xfd, 0xcb, 0x06, 0xe4);
    await testCodeEmit("set 4,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xe4);
    await testCodeEmit("set 4,(iy),l", 0xfd, 0xcb, 0x00, 0xe5);
    await testCodeEmit("set 4,(iy+6),l", 0xfd, 0xcb, 0x06, 0xe5);
    await testCodeEmit("set 4,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xe5);
    await testCodeEmit("set 4,(iy)", 0xfd, 0xcb, 0x00, 0xe6);
    await testCodeEmit("set 4,(iy+6)", 0xfd, 0xcb, 0x06, 0xe6);
    await testCodeEmit("set 4,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xe6);
    await testCodeEmit("set 4,(iy),a", 0xfd, 0xcb, 0x00, 0xe7);
    await testCodeEmit("set 4,(iy+6),a", 0xfd, 0xcb, 0x06, 0xe7);
    await testCodeEmit("set 4,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xe7);

    await testCodeEmit("set 5,(iy),b", 0xfd, 0xcb, 0x00, 0xe8);
    await testCodeEmit("set 5,(iy+6),b", 0xfd, 0xcb, 0x06, 0xe8);
    await testCodeEmit("set 5,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xe8);
    await testCodeEmit("set 5,(iy),c", 0xfd, 0xcb, 0x00, 0xe9);
    await testCodeEmit("set 5,(iy+6),c", 0xfd, 0xcb, 0x06, 0xe9);
    await testCodeEmit("set 5,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xe9);
    await testCodeEmit("set 5,(iy),d", 0xfd, 0xcb, 0x00, 0xea);
    await testCodeEmit("set 5,(iy+6),d", 0xfd, 0xcb, 0x06, 0xea);
    await testCodeEmit("set 5,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xea);
    await testCodeEmit("set 5,(iy),e", 0xfd, 0xcb, 0x00, 0xeb);
    await testCodeEmit("set 5,(iy+6),e", 0xfd, 0xcb, 0x06, 0xeb);
    await testCodeEmit("set 5,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xeb);
    await testCodeEmit("set 5,(iy),h", 0xfd, 0xcb, 0x00, 0xec);
    await testCodeEmit("set 5,(iy+6),h", 0xfd, 0xcb, 0x06, 0xec);
    await testCodeEmit("set 5,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xec);
    await testCodeEmit("set 5,(iy),l", 0xfd, 0xcb, 0x00, 0xed);
    await testCodeEmit("set 5,(iy+6),l", 0xfd, 0xcb, 0x06, 0xed);
    await testCodeEmit("set 5,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xed);
    await testCodeEmit("set 5,(iy)", 0xfd, 0xcb, 0x00, 0xee);
    await testCodeEmit("set 5,(iy+6)", 0xfd, 0xcb, 0x06, 0xee);
    await testCodeEmit("set 5,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xee);
    await testCodeEmit("set 5,(iy),a", 0xfd, 0xcb, 0x00, 0xef);
    await testCodeEmit("set 5,(iy+6),a", 0xfd, 0xcb, 0x06, 0xef);
    await testCodeEmit("set 5,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xef);

    await testCodeEmit("set 6,(iy),b", 0xfd, 0xcb, 0x00, 0xf0);
    await testCodeEmit("set 6,(iy+6),b", 0xfd, 0xcb, 0x06, 0xf0);
    await testCodeEmit("set 6,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xf0);
    await testCodeEmit("set 6,(iy),c", 0xfd, 0xcb, 0x00, 0xf1);
    await testCodeEmit("set 6,(iy+6),c", 0xfd, 0xcb, 0x06, 0xf1);
    await testCodeEmit("set 6,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xf1);
    await testCodeEmit("set 6,(iy),d", 0xfd, 0xcb, 0x00, 0xf2);
    await testCodeEmit("set 6,(iy+6),d", 0xfd, 0xcb, 0x06, 0xf2);
    await testCodeEmit("set 6,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xf2);
    await testCodeEmit("set 6,(iy),e", 0xfd, 0xcb, 0x00, 0xf3);
    await testCodeEmit("set 6,(iy+6),e", 0xfd, 0xcb, 0x06, 0xf3);
    await testCodeEmit("set 6,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xf3);
    await testCodeEmit("set 6,(iy),h", 0xfd, 0xcb, 0x00, 0xf4);
    await testCodeEmit("set 6,(iy+6),h", 0xfd, 0xcb, 0x06, 0xf4);
    await testCodeEmit("set 6,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xf4);
    await testCodeEmit("set 6,(iy),l", 0xfd, 0xcb, 0x00, 0xf5);
    await testCodeEmit("set 6,(iy+6),l", 0xfd, 0xcb, 0x06, 0xf5);
    await testCodeEmit("set 6,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xf5);
    await testCodeEmit("set 6,(iy)", 0xfd, 0xcb, 0x00, 0xf6);
    await testCodeEmit("set 6,(iy+6)", 0xfd, 0xcb, 0x06, 0xf6);
    await testCodeEmit("set 6,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xf6);
    await testCodeEmit("set 6,(iy),a", 0xfd, 0xcb, 0x00, 0xf7);
    await testCodeEmit("set 6,(iy+6),a", 0xfd, 0xcb, 0x06, 0xf7);
    await testCodeEmit("set 6,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xf7);

    await testCodeEmit("set 7,(iy),b", 0xfd, 0xcb, 0x00, 0xf8);
    await testCodeEmit("set 7,(iy+6),b", 0xfd, 0xcb, 0x06, 0xf8);
    await testCodeEmit("set 7,(iy-#0c),b", 0xfd, 0xcb, 0xf4, 0xf8);
    await testCodeEmit("set 7,(iy),c", 0xfd, 0xcb, 0x00, 0xf9);
    await testCodeEmit("set 7,(iy+6),c", 0xfd, 0xcb, 0x06, 0xf9);
    await testCodeEmit("set 7,(iy-#0c),c", 0xfd, 0xcb, 0xf4, 0xf9);
    await testCodeEmit("set 7,(iy),d", 0xfd, 0xcb, 0x00, 0xfa);
    await testCodeEmit("set 7,(iy+6),d", 0xfd, 0xcb, 0x06, 0xfa);
    await testCodeEmit("set 7,(iy-#0c),d", 0xfd, 0xcb, 0xf4, 0xfa);
    await testCodeEmit("set 7,(iy),e", 0xfd, 0xcb, 0x00, 0xfb);
    await testCodeEmit("set 7,(iy+6),e", 0xfd, 0xcb, 0x06, 0xfb);
    await testCodeEmit("set 7,(iy-#0c),e", 0xfd, 0xcb, 0xf4, 0xfb);
    await testCodeEmit("set 7,(iy),h", 0xfd, 0xcb, 0x00, 0xfc);
    await testCodeEmit("set 7,(iy+6),h", 0xfd, 0xcb, 0x06, 0xfc);
    await testCodeEmit("set 7,(iy-#0c),h", 0xfd, 0xcb, 0xf4, 0xfc);
    await testCodeEmit("set 7,(iy),l", 0xfd, 0xcb, 0x00, 0xfd);
    await testCodeEmit("set 7,(iy+6),l", 0xfd, 0xcb, 0x06, 0xfd);
    await testCodeEmit("set 7,(iy-#0c),l", 0xfd, 0xcb, 0xf4, 0xfd);
    await testCodeEmit("set 7,(iy)", 0xfd, 0xcb, 0x00, 0xfe);
    await testCodeEmit("set 7,(iy+6)", 0xfd, 0xcb, 0x06, 0xfe);
    await testCodeEmit("set 7,(iy-#0c)", 0xfd, 0xcb, 0xf4, 0xfe);
    await testCodeEmit("set 7,(iy),a", 0xfd, 0xcb, 0x00, 0xff);
    await testCodeEmit("set 7,(iy+6),a", 0xfd, 0xcb, 0x06, 0xff);
    await testCodeEmit("set 7,(iy-#0c),a", 0xfd, 0xcb, 0xf4, 0xff);
  });

  it("rlc", async () => {
    await testCodeEmit("rlc b", 0xcb, 0x00);
    await testCodeEmit("rlc c", 0xcb, 0x01);
    await testCodeEmit("rlc d", 0xcb, 0x02);
    await testCodeEmit("rlc e", 0xcb, 0x03);
    await testCodeEmit("rlc h", 0xcb, 0x04);
    await testCodeEmit("rlc l", 0xcb, 0x05);
    await testCodeEmit("rlc (hl)", 0xcb, 0x06);
    await testCodeEmit("rlc a", 0xcb, 0x07);
  });

  it("rrc", async () => {
    await testCodeEmit("rrc b", 0xcb, 0x08);
    await testCodeEmit("rrc c", 0xcb, 0x09);
    await testCodeEmit("rrc d", 0xcb, 0x0a);
    await testCodeEmit("rrc e", 0xcb, 0x0b);
    await testCodeEmit("rrc h", 0xcb, 0x0c);
    await testCodeEmit("rrc l", 0xcb, 0x0d);
    await testCodeEmit("rrc (hl)", 0xcb, 0x0e);
    await testCodeEmit("rrc a", 0xcb, 0x0f);
  });

  it("rl", async () => {
    await testCodeEmit("rl b", 0xcb, 0x10);
    await testCodeEmit("rl c", 0xcb, 0x11);
    await testCodeEmit("rl d", 0xcb, 0x12);
    await testCodeEmit("rl e", 0xcb, 0x13);
    await testCodeEmit("rl h", 0xcb, 0x14);
    await testCodeEmit("rl l", 0xcb, 0x15);
    await testCodeEmit("rl (hl)", 0xcb, 0x16);
    await testCodeEmit("rl a", 0xcb, 0x17);
  });

  it("rr", async () => {
    await testCodeEmit("rr b", 0xcb, 0x18);
    await testCodeEmit("rr c", 0xcb, 0x19);
    await testCodeEmit("rr d", 0xcb, 0x1a);
    await testCodeEmit("rr e", 0xcb, 0x1b);
    await testCodeEmit("rr h", 0xcb, 0x1c);
    await testCodeEmit("rr l", 0xcb, 0x1d);
    await testCodeEmit("rr (hl)", 0xcb, 0x1e);
    await testCodeEmit("rr a", 0xcb, 0x1f);
  });

  it("sla", async () => {
    await testCodeEmit("sla b", 0xcb, 0x20);
    await testCodeEmit("sla c", 0xcb, 0x21);
    await testCodeEmit("sla d", 0xcb, 0x22);
    await testCodeEmit("sla e", 0xcb, 0x23);
    await testCodeEmit("sla h", 0xcb, 0x24);
    await testCodeEmit("sla l", 0xcb, 0x25);
    await testCodeEmit("sla (hl)", 0xcb, 0x26);
    await testCodeEmit("sla a", 0xcb, 0x27);
  });

  it("sra", async () => {
    await testCodeEmit("sra b", 0xcb, 0x28);
    await testCodeEmit("sra c", 0xcb, 0x29);
    await testCodeEmit("sra d", 0xcb, 0x2a);
    await testCodeEmit("sra e", 0xcb, 0x2b);
    await testCodeEmit("sra h", 0xcb, 0x2c);
    await testCodeEmit("sra l", 0xcb, 0x2d);
    await testCodeEmit("sra (hl)", 0xcb, 0x2e);
    await testCodeEmit("sra a", 0xcb, 0x2f);
  });

  it("sll", async () => {
    await testCodeEmit("sll b", 0xcb, 0x30);
    await testCodeEmit("sll c", 0xcb, 0x31);
    await testCodeEmit("sll d", 0xcb, 0x32);
    await testCodeEmit("sll e", 0xcb, 0x33);
    await testCodeEmit("sll h", 0xcb, 0x34);
    await testCodeEmit("sll l", 0xcb, 0x35);
    await testCodeEmit("sll (hl)", 0xcb, 0x36);
    await testCodeEmit("sll a", 0xcb, 0x37);
  });

  it("srl", async () => {
    await testCodeEmit("srl b", 0xcb, 0x38);
    await testCodeEmit("srl c", 0xcb, 0x39);
    await testCodeEmit("srl d", 0xcb, 0x3a);
    await testCodeEmit("srl e", 0xcb, 0x3b);
    await testCodeEmit("srl h", 0xcb, 0x3c);
    await testCodeEmit("srl l", 0xcb, 0x3d);
    await testCodeEmit("srl (hl)", 0xcb, 0x3e);
    await testCodeEmit("srl a", 0xcb, 0x3f);
  });

  it("rlc: indexed instructions", async () => {
    await testCodeEmit("rlc (ix),b", 0xdd, 0xcb, 0x00, 0x00);
    await testCodeEmit("rlc (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x00);
    await testCodeEmit("rlc (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x00);
    await testCodeEmit("rlc (ix),c", 0xdd, 0xcb, 0x00, 0x01);
    await testCodeEmit("rlc (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x01);
    await testCodeEmit("rlc (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x01);
    await testCodeEmit("rlc (ix),d", 0xdd, 0xcb, 0x00, 0x02);
    await testCodeEmit("rlc (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x02);
    await testCodeEmit("rlc (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x02);
    await testCodeEmit("rlc (ix),e", 0xdd, 0xcb, 0x00, 0x03);
    await testCodeEmit("rlc (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x03);
    await testCodeEmit("rlc (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x03);
    await testCodeEmit("rlc (ix),h", 0xdd, 0xcb, 0x00, 0x04);
    await testCodeEmit("rlc (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x04);
    await testCodeEmit("rlc (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x04);
    await testCodeEmit("rlc (ix),l", 0xdd, 0xcb, 0x00, 0x05);
    await testCodeEmit("rlc (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x05);
    await testCodeEmit("rlc (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x05);
    await testCodeEmit("rlc (ix)", 0xdd, 0xcb, 0x00, 0x06);
    await testCodeEmit("rlc (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x06);
    await testCodeEmit("rlc (ix-#08)", 0xdd, 0xcb, 0xf8, 0x06);
    await testCodeEmit("rlc (ix),a", 0xdd, 0xcb, 0x00, 0x07);
    await testCodeEmit("rlc (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x07);
    await testCodeEmit("rlc (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x07);

    await testCodeEmit("rrc (ix),b", 0xdd, 0xcb, 0x00, 0x08);
    await testCodeEmit("rrc (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x08);
    await testCodeEmit("rrc (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x08);
    await testCodeEmit("rrc (ix),c", 0xdd, 0xcb, 0x00, 0x09);
    await testCodeEmit("rrc (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x09);
    await testCodeEmit("rrc (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x09);
    await testCodeEmit("rrc (ix),d", 0xdd, 0xcb, 0x00, 0x0a);
    await testCodeEmit("rrc (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x0a);
    await testCodeEmit("rrc (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x0a);
    await testCodeEmit("rrc (ix),e", 0xdd, 0xcb, 0x00, 0x0b);
    await testCodeEmit("rrc (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x0b);
    await testCodeEmit("rrc (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x0b);
    await testCodeEmit("rrc (ix),h", 0xdd, 0xcb, 0x00, 0x0c);
    await testCodeEmit("rrc (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x0c);
    await testCodeEmit("rrc (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x0c);
    await testCodeEmit("rrc (ix),l", 0xdd, 0xcb, 0x00, 0x0d);
    await testCodeEmit("rrc (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x0d);
    await testCodeEmit("rrc (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x0d);
    await testCodeEmit("rrc (ix)", 0xdd, 0xcb, 0x00, 0x0e);
    await testCodeEmit("rrc (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x0e);
    await testCodeEmit("rrc (ix-#08)", 0xdd, 0xcb, 0xf8, 0x0e);
    await testCodeEmit("rrc (ix),a", 0xdd, 0xcb, 0x00, 0x0f);
    await testCodeEmit("rrc (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x0f);
    await testCodeEmit("rrc (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x0f);

    await testCodeEmit("rl (ix),b", 0xdd, 0xcb, 0x00, 0x10);
    await testCodeEmit("rl (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x10);
    await testCodeEmit("rl (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x10);
    await testCodeEmit("rl (ix),c", 0xdd, 0xcb, 0x00, 0x11);
    await testCodeEmit("rl (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x11);
    await testCodeEmit("rl (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x11);
    await testCodeEmit("rl (ix),d", 0xdd, 0xcb, 0x00, 0x12);
    await testCodeEmit("rl (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x12);
    await testCodeEmit("rl (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x12);
    await testCodeEmit("rl (ix),e", 0xdd, 0xcb, 0x00, 0x13);
    await testCodeEmit("rl (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x13);
    await testCodeEmit("rl (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x13);
    await testCodeEmit("rl (ix),h", 0xdd, 0xcb, 0x00, 0x14);
    await testCodeEmit("rl (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x14);
    await testCodeEmit("rl (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x14);
    await testCodeEmit("rl (ix),l", 0xdd, 0xcb, 0x00, 0x15);
    await testCodeEmit("rl (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x15);
    await testCodeEmit("rl (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x15);
    await testCodeEmit("rl (ix)", 0xdd, 0xcb, 0x00, 0x16);
    await testCodeEmit("rl (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x16);
    await testCodeEmit("rl (ix-#08)", 0xdd, 0xcb, 0xf8, 0x16);
    await testCodeEmit("rl (ix),a", 0xdd, 0xcb, 0x00, 0x17);
    await testCodeEmit("rl (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x17);
    await testCodeEmit("rl (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x17);

    await testCodeEmit("rr (ix),b", 0xdd, 0xcb, 0x00, 0x18);
    await testCodeEmit("rr (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x18);
    await testCodeEmit("rr (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x18);
    await testCodeEmit("rr (ix),c", 0xdd, 0xcb, 0x00, 0x19);
    await testCodeEmit("rr (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x19);
    await testCodeEmit("rr (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x19);
    await testCodeEmit("rr (ix),d", 0xdd, 0xcb, 0x00, 0x1a);
    await testCodeEmit("rr (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x1a);
    await testCodeEmit("rr (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x1a);
    await testCodeEmit("rr (ix),e", 0xdd, 0xcb, 0x00, 0x1b);
    await testCodeEmit("rr (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x1b);
    await testCodeEmit("rr (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x1b);
    await testCodeEmit("rr (ix),h", 0xdd, 0xcb, 0x00, 0x1c);
    await testCodeEmit("rr (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x1c);
    await testCodeEmit("rr (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x1c);
    await testCodeEmit("rr (ix),l", 0xdd, 0xcb, 0x00, 0x1d);
    await testCodeEmit("rr (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x1d);
    await testCodeEmit("rr (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x1d);
    await testCodeEmit("rr (ix)", 0xdd, 0xcb, 0x00, 0x1e);
    await testCodeEmit("rr (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x1e);
    await testCodeEmit("rr (ix-#08)", 0xdd, 0xcb, 0xf8, 0x1e);
    await testCodeEmit("rr (ix),a", 0xdd, 0xcb, 0x00, 0x1f);
    await testCodeEmit("rr (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x1f);
    await testCodeEmit("rr (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x1f);

    await testCodeEmit("sla (ix),b", 0xdd, 0xcb, 0x00, 0x20);
    await testCodeEmit("sla (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x20);
    await testCodeEmit("sla (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x20);
    await testCodeEmit("sla (ix),c", 0xdd, 0xcb, 0x00, 0x21);
    await testCodeEmit("sla (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x21);
    await testCodeEmit("sla (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x21);
    await testCodeEmit("sla (ix),d", 0xdd, 0xcb, 0x00, 0x22);
    await testCodeEmit("sla (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x22);
    await testCodeEmit("sla (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x22);
    await testCodeEmit("sla (ix),e", 0xdd, 0xcb, 0x00, 0x23);
    await testCodeEmit("sla (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x23);
    await testCodeEmit("sla (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x23);
    await testCodeEmit("sla (ix),h", 0xdd, 0xcb, 0x00, 0x24);
    await testCodeEmit("sla (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x24);
    await testCodeEmit("sla (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x24);
    await testCodeEmit("sla (ix),l", 0xdd, 0xcb, 0x00, 0x25);
    await testCodeEmit("sla (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x25);
    await testCodeEmit("sla (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x25);
    await testCodeEmit("sla (ix)", 0xdd, 0xcb, 0x00, 0x26);
    await testCodeEmit("sla (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x26);
    await testCodeEmit("sla (ix-#08)", 0xdd, 0xcb, 0xf8, 0x26);
    await testCodeEmit("sla (ix),a", 0xdd, 0xcb, 0x00, 0x27);
    await testCodeEmit("sla (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x27);
    await testCodeEmit("sla (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x27);

    await testCodeEmit("sra (ix),b", 0xdd, 0xcb, 0x00, 0x28);
    await testCodeEmit("sra (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x28);
    await testCodeEmit("sra (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x28);
    await testCodeEmit("sra (ix),c", 0xdd, 0xcb, 0x00, 0x29);
    await testCodeEmit("sra (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x29);
    await testCodeEmit("sra (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x29);
    await testCodeEmit("sra (ix),d", 0xdd, 0xcb, 0x00, 0x2a);
    await testCodeEmit("sra (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x2a);
    await testCodeEmit("sra (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x2a);
    await testCodeEmit("sra (ix),e", 0xdd, 0xcb, 0x00, 0x2b);
    await testCodeEmit("sra (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x2b);
    await testCodeEmit("sra (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x2b);
    await testCodeEmit("sra (ix),h", 0xdd, 0xcb, 0x00, 0x2c);
    await testCodeEmit("sra (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x2c);
    await testCodeEmit("sra (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x2c);
    await testCodeEmit("sra (ix),l", 0xdd, 0xcb, 0x00, 0x2d);
    await testCodeEmit("sra (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x2d);
    await testCodeEmit("sra (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x2d);
    await testCodeEmit("sra (ix)", 0xdd, 0xcb, 0x00, 0x2e);
    await testCodeEmit("sra (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x2e);
    await testCodeEmit("sra (ix-#08)", 0xdd, 0xcb, 0xf8, 0x2e);
    await testCodeEmit("sra (ix),a", 0xdd, 0xcb, 0x00, 0x2f);
    await testCodeEmit("sra (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x2f);
    await testCodeEmit("sra (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x2f);

    await testCodeEmit("sll (ix),b", 0xdd, 0xcb, 0x00, 0x30);
    await testCodeEmit("sll (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x30);
    await testCodeEmit("sll (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x30);
    await testCodeEmit("sll (ix),c", 0xdd, 0xcb, 0x00, 0x31);
    await testCodeEmit("sll (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x31);
    await testCodeEmit("sll (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x31);
    await testCodeEmit("sll (ix),d", 0xdd, 0xcb, 0x00, 0x32);
    await testCodeEmit("sll (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x32);
    await testCodeEmit("sll (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x32);
    await testCodeEmit("sll (ix),e", 0xdd, 0xcb, 0x00, 0x33);
    await testCodeEmit("sll (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x33);
    await testCodeEmit("sll (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x33);
    await testCodeEmit("sll (ix),h", 0xdd, 0xcb, 0x00, 0x34);
    await testCodeEmit("sll (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x34);
    await testCodeEmit("sll (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x34);
    await testCodeEmit("sll (ix),l", 0xdd, 0xcb, 0x00, 0x35);
    await testCodeEmit("sll (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x35);
    await testCodeEmit("sll (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x35);
    await testCodeEmit("sll (ix)", 0xdd, 0xcb, 0x00, 0x36);
    await testCodeEmit("sll (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x36);
    await testCodeEmit("sll (ix-#08)", 0xdd, 0xcb, 0xf8, 0x36);
    await testCodeEmit("sll (ix),a", 0xdd, 0xcb, 0x00, 0x37);
    await testCodeEmit("sll (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x37);
    await testCodeEmit("sll (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x37);

    await testCodeEmit("srl (ix),b", 0xdd, 0xcb, 0x00, 0x38);
    await testCodeEmit("srl (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x38);
    await testCodeEmit("srl (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x38);
    await testCodeEmit("srl (ix),c", 0xdd, 0xcb, 0x00, 0x39);
    await testCodeEmit("srl (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x39);
    await testCodeEmit("srl (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x39);
    await testCodeEmit("srl (ix),d", 0xdd, 0xcb, 0x00, 0x3a);
    await testCodeEmit("srl (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x3a);
    await testCodeEmit("srl (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x3a);
    await testCodeEmit("srl (ix),e", 0xdd, 0xcb, 0x00, 0x3b);
    await testCodeEmit("srl (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x3b);
    await testCodeEmit("srl (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x3b);
    await testCodeEmit("srl (ix),h", 0xdd, 0xcb, 0x00, 0x3c);
    await testCodeEmit("srl (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x3c);
    await testCodeEmit("srl (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x3c);
    await testCodeEmit("srl (ix),l", 0xdd, 0xcb, 0x00, 0x3d);
    await testCodeEmit("srl (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x3d);
    await testCodeEmit("srl (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x3d);
    await testCodeEmit("srl (ix)", 0xdd, 0xcb, 0x00, 0x3e);
    await testCodeEmit("srl (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x3e);
    await testCodeEmit("srl (ix-#08)", 0xdd, 0xcb, 0xf8, 0x3e);
    await testCodeEmit("srl (ix),a", 0xdd, 0xcb, 0x00, 0x3f);
    await testCodeEmit("srl (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x3f);
    await testCodeEmit("srl (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x3f);

    await testCodeEmit("rlc (iy),b", 0xfd, 0xcb, 0x00, 0x00);
    await testCodeEmit("rlc (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x00);
    await testCodeEmit("rlc (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x00);
    await testCodeEmit("rlc (iy),c", 0xfd, 0xcb, 0x00, 0x01);
    await testCodeEmit("rlc (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x01);
    await testCodeEmit("rlc (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x01);
    await testCodeEmit("rlc (iy),d", 0xfd, 0xcb, 0x00, 0x02);
    await testCodeEmit("rlc (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x02);
    await testCodeEmit("rlc (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x02);
    await testCodeEmit("rlc (iy),e", 0xfd, 0xcb, 0x00, 0x03);
    await testCodeEmit("rlc (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x03);
    await testCodeEmit("rlc (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x03);
    await testCodeEmit("rlc (iy),h", 0xfd, 0xcb, 0x00, 0x04);
    await testCodeEmit("rlc (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x04);
    await testCodeEmit("rlc (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x04);
    await testCodeEmit("rlc (iy),l", 0xfd, 0xcb, 0x00, 0x05);
    await testCodeEmit("rlc (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x05);
    await testCodeEmit("rlc (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x05);
    await testCodeEmit("rlc (iy)", 0xfd, 0xcb, 0x00, 0x06);
    await testCodeEmit("rlc (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x06);
    await testCodeEmit("rlc (iy-#08)", 0xfd, 0xcb, 0xf8, 0x06);
    await testCodeEmit("rlc (iy),a", 0xfd, 0xcb, 0x00, 0x07);
    await testCodeEmit("rlc (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x07);
    await testCodeEmit("rlc (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x07);

    await testCodeEmit("rrc (iy),b", 0xfd, 0xcb, 0x00, 0x08);
    await testCodeEmit("rrc (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x08);
    await testCodeEmit("rrc (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x08);
    await testCodeEmit("rrc (iy),c", 0xfd, 0xcb, 0x00, 0x09);
    await testCodeEmit("rrc (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x09);
    await testCodeEmit("rrc (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x09);
    await testCodeEmit("rrc (iy),d", 0xfd, 0xcb, 0x00, 0x0a);
    await testCodeEmit("rrc (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x0a);
    await testCodeEmit("rrc (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x0a);
    await testCodeEmit("rrc (iy),e", 0xfd, 0xcb, 0x00, 0x0b);
    await testCodeEmit("rrc (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x0b);
    await testCodeEmit("rrc (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x0b);
    await testCodeEmit("rrc (iy),h", 0xfd, 0xcb, 0x00, 0x0c);
    await testCodeEmit("rrc (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x0c);
    await testCodeEmit("rrc (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x0c);
    await testCodeEmit("rrc (iy),l", 0xfd, 0xcb, 0x00, 0x0d);
    await testCodeEmit("rrc (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x0d);
    await testCodeEmit("rrc (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x0d);
    await testCodeEmit("rrc (iy)", 0xfd, 0xcb, 0x00, 0x0e);
    await testCodeEmit("rrc (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x0e);
    await testCodeEmit("rrc (iy-#08)", 0xfd, 0xcb, 0xf8, 0x0e);
    await testCodeEmit("rrc (iy),a", 0xfd, 0xcb, 0x00, 0x0f);
    await testCodeEmit("rrc (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x0f);
    await testCodeEmit("rrc (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x0f);

    await testCodeEmit("rl (iy),b", 0xfd, 0xcb, 0x00, 0x10);
    await testCodeEmit("rl (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x10);
    await testCodeEmit("rl (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x10);
    await testCodeEmit("rl (iy),c", 0xfd, 0xcb, 0x00, 0x11);
    await testCodeEmit("rl (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x11);
    await testCodeEmit("rl (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x11);
    await testCodeEmit("rl (iy),d", 0xfd, 0xcb, 0x00, 0x12);
    await testCodeEmit("rl (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x12);
    await testCodeEmit("rl (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x12);
    await testCodeEmit("rl (iy),e", 0xfd, 0xcb, 0x00, 0x13);
    await testCodeEmit("rl (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x13);
    await testCodeEmit("rl (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x13);
    await testCodeEmit("rl (iy),h", 0xfd, 0xcb, 0x00, 0x14);
    await testCodeEmit("rl (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x14);
    await testCodeEmit("rl (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x14);
    await testCodeEmit("rl (iy),l", 0xfd, 0xcb, 0x00, 0x15);
    await testCodeEmit("rl (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x15);
    await testCodeEmit("rl (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x15);
    await testCodeEmit("rl (iy)", 0xfd, 0xcb, 0x00, 0x16);
    await testCodeEmit("rl (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x16);
    await testCodeEmit("rl (iy-#08)", 0xfd, 0xcb, 0xf8, 0x16);
    await testCodeEmit("rl (iy),a", 0xfd, 0xcb, 0x00, 0x17);
    await testCodeEmit("rl (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x17);
    await testCodeEmit("rl (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x17);

    await testCodeEmit("rr (iy),b", 0xfd, 0xcb, 0x00, 0x18);
    await testCodeEmit("rr (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x18);
    await testCodeEmit("rr (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x18);
    await testCodeEmit("rr (iy),c", 0xfd, 0xcb, 0x00, 0x19);
    await testCodeEmit("rr (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x19);
    await testCodeEmit("rr (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x19);
    await testCodeEmit("rr (iy),d", 0xfd, 0xcb, 0x00, 0x1a);
    await testCodeEmit("rr (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x1a);
    await testCodeEmit("rr (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x1a);
    await testCodeEmit("rr (iy),e", 0xfd, 0xcb, 0x00, 0x1b);
    await testCodeEmit("rr (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x1b);
    await testCodeEmit("rr (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x1b);
    await testCodeEmit("rr (iy),h", 0xfd, 0xcb, 0x00, 0x1c);
    await testCodeEmit("rr (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x1c);
    await testCodeEmit("rr (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x1c);
    await testCodeEmit("rr (iy),l", 0xfd, 0xcb, 0x00, 0x1d);
    await testCodeEmit("rr (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x1d);
    await testCodeEmit("rr (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x1d);
    await testCodeEmit("rr (iy)", 0xfd, 0xcb, 0x00, 0x1e);
    await testCodeEmit("rr (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x1e);
    await testCodeEmit("rr (iy-#08)", 0xfd, 0xcb, 0xf8, 0x1e);
    await testCodeEmit("rr (iy),a", 0xfd, 0xcb, 0x00, 0x1f);
    await testCodeEmit("rr (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x1f);
    await testCodeEmit("rr (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x1f);

    await testCodeEmit("sla (iy),b", 0xfd, 0xcb, 0x00, 0x20);
    await testCodeEmit("sla (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x20);
    await testCodeEmit("sla (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x20);
    await testCodeEmit("sla (iy),c", 0xfd, 0xcb, 0x00, 0x21);
    await testCodeEmit("sla (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x21);
    await testCodeEmit("sla (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x21);
    await testCodeEmit("sla (iy),d", 0xfd, 0xcb, 0x00, 0x22);
    await testCodeEmit("sla (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x22);
    await testCodeEmit("sla (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x22);
    await testCodeEmit("sla (iy),e", 0xfd, 0xcb, 0x00, 0x23);
    await testCodeEmit("sla (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x23);
    await testCodeEmit("sla (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x23);
    await testCodeEmit("sla (iy),h", 0xfd, 0xcb, 0x00, 0x24);
    await testCodeEmit("sla (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x24);
    await testCodeEmit("sla (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x24);
    await testCodeEmit("sla (iy),l", 0xfd, 0xcb, 0x00, 0x25);
    await testCodeEmit("sla (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x25);
    await testCodeEmit("sla (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x25);
    await testCodeEmit("sla (iy)", 0xfd, 0xcb, 0x00, 0x26);
    await testCodeEmit("sla (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x26);
    await testCodeEmit("sla (iy-#08)", 0xfd, 0xcb, 0xf8, 0x26);
    await testCodeEmit("sla (iy),a", 0xfd, 0xcb, 0x00, 0x27);
    await testCodeEmit("sla (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x27);
    await testCodeEmit("sla (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x27);

    await testCodeEmit("sra (iy),b", 0xfd, 0xcb, 0x00, 0x28);
    await testCodeEmit("sra (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x28);
    await testCodeEmit("sra (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x28);
    await testCodeEmit("sra (iy),c", 0xfd, 0xcb, 0x00, 0x29);
    await testCodeEmit("sra (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x29);
    await testCodeEmit("sra (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x29);
    await testCodeEmit("sra (iy),d", 0xfd, 0xcb, 0x00, 0x2a);
    await testCodeEmit("sra (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x2a);
    await testCodeEmit("sra (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x2a);
    await testCodeEmit("sra (iy),e", 0xfd, 0xcb, 0x00, 0x2b);
    await testCodeEmit("sra (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x2b);
    await testCodeEmit("sra (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x2b);
    await testCodeEmit("sra (iy),h", 0xfd, 0xcb, 0x00, 0x2c);
    await testCodeEmit("sra (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x2c);
    await testCodeEmit("sra (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x2c);
    await testCodeEmit("sra (iy),l", 0xfd, 0xcb, 0x00, 0x2d);
    await testCodeEmit("sra (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x2d);
    await testCodeEmit("sra (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x2d);
    await testCodeEmit("sra (iy)", 0xfd, 0xcb, 0x00, 0x2e);
    await testCodeEmit("sra (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x2e);
    await testCodeEmit("sra (iy-#08)", 0xfd, 0xcb, 0xf8, 0x2e);
    await testCodeEmit("sra (iy),a", 0xfd, 0xcb, 0x00, 0x2f);
    await testCodeEmit("sra (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x2f);
    await testCodeEmit("sra (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x2f);

    await testCodeEmit("sll (iy),b", 0xfd, 0xcb, 0x00, 0x30);
    await testCodeEmit("sll (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x30);
    await testCodeEmit("sll (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x30);
    await testCodeEmit("sll (iy),c", 0xfd, 0xcb, 0x00, 0x31);
    await testCodeEmit("sll (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x31);
    await testCodeEmit("sll (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x31);
    await testCodeEmit("sll (iy),d", 0xfd, 0xcb, 0x00, 0x32);
    await testCodeEmit("sll (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x32);
    await testCodeEmit("sll (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x32);
    await testCodeEmit("sll (iy),e", 0xfd, 0xcb, 0x00, 0x33);
    await testCodeEmit("sll (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x33);
    await testCodeEmit("sll (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x33);
    await testCodeEmit("sll (iy),h", 0xfd, 0xcb, 0x00, 0x34);
    await testCodeEmit("sll (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x34);
    await testCodeEmit("sll (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x34);
    await testCodeEmit("sll (iy),l", 0xfd, 0xcb, 0x00, 0x35);
    await testCodeEmit("sll (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x35);
    await testCodeEmit("sll (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x35);
    await testCodeEmit("sll (iy)", 0xfd, 0xcb, 0x00, 0x36);
    await testCodeEmit("sll (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x36);
    await testCodeEmit("sll (iy-#08)", 0xfd, 0xcb, 0xf8, 0x36);
    await testCodeEmit("sll (iy),a", 0xfd, 0xcb, 0x00, 0x37);
    await testCodeEmit("sll (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x37);
    await testCodeEmit("sll (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x37);

    await testCodeEmit("srl (iy),b", 0xfd, 0xcb, 0x00, 0x38);
    await testCodeEmit("srl (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x38);
    await testCodeEmit("srl (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x38);
    await testCodeEmit("srl (iy),c", 0xfd, 0xcb, 0x00, 0x39);
    await testCodeEmit("srl (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x39);
    await testCodeEmit("srl (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x39);
    await testCodeEmit("srl (iy),d", 0xfd, 0xcb, 0x00, 0x3a);
    await testCodeEmit("srl (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x3a);
    await testCodeEmit("srl (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x3a);
    await testCodeEmit("srl (iy),e", 0xfd, 0xcb, 0x00, 0x3b);
    await testCodeEmit("srl (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x3b);
    await testCodeEmit("srl (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x3b);
    await testCodeEmit("srl (iy),h", 0xfd, 0xcb, 0x00, 0x3c);
    await testCodeEmit("srl (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x3c);
    await testCodeEmit("srl (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x3c);
    await testCodeEmit("srl (iy),l", 0xfd, 0xcb, 0x00, 0x3d);
    await testCodeEmit("srl (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x3d);
    await testCodeEmit("srl (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x3d);
    await testCodeEmit("srl (iy)", 0xfd, 0xcb, 0x00, 0x3e);
    await testCodeEmit("srl (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x3e);
    await testCodeEmit("srl (iy-#08)", 0xfd, 0xcb, 0xf8, 0x3e);
    await testCodeEmit("srl (iy),a", 0xfd, 0xcb, 0x00, 0x3f);
    await testCodeEmit("srl (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x3f);
    await testCodeEmit("srl (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x3f);
  });

  it("rrc: indexed instructions", async () => {
    await testCodeEmit("rrc (ix),b", 0xdd, 0xcb, 0x00, 0x08);
    await testCodeEmit("rrc (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x08);
    await testCodeEmit("rrc (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x08);
    await testCodeEmit("rrc (ix),c", 0xdd, 0xcb, 0x00, 0x09);
    await testCodeEmit("rrc (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x09);
    await testCodeEmit("rrc (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x09);
    await testCodeEmit("rrc (ix),d", 0xdd, 0xcb, 0x00, 0x0a);
    await testCodeEmit("rrc (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x0a);
    await testCodeEmit("rrc (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x0a);
    await testCodeEmit("rrc (ix),e", 0xdd, 0xcb, 0x00, 0x0b);
    await testCodeEmit("rrc (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x0b);
    await testCodeEmit("rrc (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x0b);
    await testCodeEmit("rrc (ix),h", 0xdd, 0xcb, 0x00, 0x0c);
    await testCodeEmit("rrc (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x0c);
    await testCodeEmit("rrc (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x0c);
    await testCodeEmit("rrc (ix),l", 0xdd, 0xcb, 0x00, 0x0d);
    await testCodeEmit("rrc (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x0d);
    await testCodeEmit("rrc (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x0d);
    await testCodeEmit("rrc (ix)", 0xdd, 0xcb, 0x00, 0x0e);
    await testCodeEmit("rrc (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x0e);
    await testCodeEmit("rrc (ix-#08)", 0xdd, 0xcb, 0xf8, 0x0e);
    await testCodeEmit("rrc (ix),a", 0xdd, 0xcb, 0x00, 0x0f);
    await testCodeEmit("rrc (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x0f);
    await testCodeEmit("rrc (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x0f);

    await testCodeEmit("rrc (iy),b", 0xfd, 0xcb, 0x00, 0x08);
    await testCodeEmit("rrc (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x08);
    await testCodeEmit("rrc (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x08);
    await testCodeEmit("rrc (iy),c", 0xfd, 0xcb, 0x00, 0x09);
    await testCodeEmit("rrc (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x09);
    await testCodeEmit("rrc (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x09);
    await testCodeEmit("rrc (iy),d", 0xfd, 0xcb, 0x00, 0x0a);
    await testCodeEmit("rrc (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x0a);
    await testCodeEmit("rrc (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x0a);
    await testCodeEmit("rrc (iy),e", 0xfd, 0xcb, 0x00, 0x0b);
    await testCodeEmit("rrc (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x0b);
    await testCodeEmit("rrc (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x0b);
    await testCodeEmit("rrc (iy),h", 0xfd, 0xcb, 0x00, 0x0c);
    await testCodeEmit("rrc (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x0c);
    await testCodeEmit("rrc (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x0c);
    await testCodeEmit("rrc (iy),l", 0xfd, 0xcb, 0x00, 0x0d);
    await testCodeEmit("rrc (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x0d);
    await testCodeEmit("rrc (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x0d);
    await testCodeEmit("rrc (iy)", 0xfd, 0xcb, 0x00, 0x0e);
    await testCodeEmit("rrc (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x0e);
    await testCodeEmit("rrc (iy-#08)", 0xfd, 0xcb, 0xf8, 0x0e);
    await testCodeEmit("rrc (iy),a", 0xfd, 0xcb, 0x00, 0x0f);
    await testCodeEmit("rrc (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x0f);
    await testCodeEmit("rrc (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x0f);
  });

  it("rl: indexed instructions", async () => {
    await testCodeEmit("rl (ix),b", 0xdd, 0xcb, 0x00, 0x10);
    await testCodeEmit("rl (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x10);
    await testCodeEmit("rl (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x10);
    await testCodeEmit("rl (ix),c", 0xdd, 0xcb, 0x00, 0x11);
    await testCodeEmit("rl (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x11);
    await testCodeEmit("rl (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x11);
    await testCodeEmit("rl (ix),d", 0xdd, 0xcb, 0x00, 0x12);
    await testCodeEmit("rl (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x12);
    await testCodeEmit("rl (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x12);
    await testCodeEmit("rl (ix),e", 0xdd, 0xcb, 0x00, 0x13);
    await testCodeEmit("rl (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x13);
    await testCodeEmit("rl (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x13);
    await testCodeEmit("rl (ix),h", 0xdd, 0xcb, 0x00, 0x14);
    await testCodeEmit("rl (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x14);
    await testCodeEmit("rl (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x14);
    await testCodeEmit("rl (ix),l", 0xdd, 0xcb, 0x00, 0x15);
    await testCodeEmit("rl (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x15);
    await testCodeEmit("rl (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x15);
    await testCodeEmit("rl (ix)", 0xdd, 0xcb, 0x00, 0x16);
    await testCodeEmit("rl (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x16);
    await testCodeEmit("rl (ix-#08)", 0xdd, 0xcb, 0xf8, 0x16);
    await testCodeEmit("rl (ix),a", 0xdd, 0xcb, 0x00, 0x17);
    await testCodeEmit("rl (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x17);
    await testCodeEmit("rl (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x17);

    await testCodeEmit("rl (iy),b", 0xfd, 0xcb, 0x00, 0x10);
    await testCodeEmit("rl (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x10);
    await testCodeEmit("rl (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x10);
    await testCodeEmit("rl (iy),c", 0xfd, 0xcb, 0x00, 0x11);
    await testCodeEmit("rl (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x11);
    await testCodeEmit("rl (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x11);
    await testCodeEmit("rl (iy),d", 0xfd, 0xcb, 0x00, 0x12);
    await testCodeEmit("rl (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x12);
    await testCodeEmit("rl (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x12);
    await testCodeEmit("rl (iy),e", 0xfd, 0xcb, 0x00, 0x13);
    await testCodeEmit("rl (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x13);
    await testCodeEmit("rl (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x13);
    await testCodeEmit("rl (iy),h", 0xfd, 0xcb, 0x00, 0x14);
    await testCodeEmit("rl (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x14);
    await testCodeEmit("rl (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x14);
    await testCodeEmit("rl (iy),l", 0xfd, 0xcb, 0x00, 0x15);
    await testCodeEmit("rl (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x15);
    await testCodeEmit("rl (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x15);
    await testCodeEmit("rl (iy)", 0xfd, 0xcb, 0x00, 0x16);
    await testCodeEmit("rl (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x16);
    await testCodeEmit("rl (iy-#08)", 0xfd, 0xcb, 0xf8, 0x16);
    await testCodeEmit("rl (iy),a", 0xfd, 0xcb, 0x00, 0x17);
    await testCodeEmit("rl (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x17);
    await testCodeEmit("rl (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x17);
  });

  it("rr: indexed instructions", async () => {
    await testCodeEmit("rr (ix),b", 0xdd, 0xcb, 0x00, 0x18);
    await testCodeEmit("rr (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x18);
    await testCodeEmit("rr (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x18);
    await testCodeEmit("rr (ix),c", 0xdd, 0xcb, 0x00, 0x19);
    await testCodeEmit("rr (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x19);
    await testCodeEmit("rr (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x19);
    await testCodeEmit("rr (ix),d", 0xdd, 0xcb, 0x00, 0x1a);
    await testCodeEmit("rr (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x1a);
    await testCodeEmit("rr (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x1a);
    await testCodeEmit("rr (ix),e", 0xdd, 0xcb, 0x00, 0x1b);
    await testCodeEmit("rr (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x1b);
    await testCodeEmit("rr (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x1b);
    await testCodeEmit("rr (ix),h", 0xdd, 0xcb, 0x00, 0x1c);
    await testCodeEmit("rr (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x1c);
    await testCodeEmit("rr (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x1c);
    await testCodeEmit("rr (ix),l", 0xdd, 0xcb, 0x00, 0x1d);
    await testCodeEmit("rr (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x1d);
    await testCodeEmit("rr (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x1d);
    await testCodeEmit("rr (ix)", 0xdd, 0xcb, 0x00, 0x1e);
    await testCodeEmit("rr (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x1e);
    await testCodeEmit("rr (ix-#08)", 0xdd, 0xcb, 0xf8, 0x1e);
    await testCodeEmit("rr (ix),a", 0xdd, 0xcb, 0x00, 0x1f);
    await testCodeEmit("rr (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x1f);
    await testCodeEmit("rr (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x1f);

    await testCodeEmit("rr (iy),b", 0xfd, 0xcb, 0x00, 0x18);
    await testCodeEmit("rr (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x18);
    await testCodeEmit("rr (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x18);
    await testCodeEmit("rr (iy),c", 0xfd, 0xcb, 0x00, 0x19);
    await testCodeEmit("rr (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x19);
    await testCodeEmit("rr (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x19);
    await testCodeEmit("rr (iy),d", 0xfd, 0xcb, 0x00, 0x1a);
    await testCodeEmit("rr (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x1a);
    await testCodeEmit("rr (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x1a);
    await testCodeEmit("rr (iy),e", 0xfd, 0xcb, 0x00, 0x1b);
    await testCodeEmit("rr (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x1b);
    await testCodeEmit("rr (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x1b);
    await testCodeEmit("rr (iy),h", 0xfd, 0xcb, 0x00, 0x1c);
    await testCodeEmit("rr (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x1c);
    await testCodeEmit("rr (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x1c);
    await testCodeEmit("rr (iy),l", 0xfd, 0xcb, 0x00, 0x1d);
    await testCodeEmit("rr (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x1d);
    await testCodeEmit("rr (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x1d);
    await testCodeEmit("rr (iy)", 0xfd, 0xcb, 0x00, 0x1e);
    await testCodeEmit("rr (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x1e);
    await testCodeEmit("rr (iy-#08)", 0xfd, 0xcb, 0xf8, 0x1e);
    await testCodeEmit("rr (iy),a", 0xfd, 0xcb, 0x00, 0x1f);
    await testCodeEmit("rr (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x1f);
    await testCodeEmit("rr (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x1f);
  });

  it("sla: indexed instructions", async () => {
    await testCodeEmit("sla (ix),b", 0xdd, 0xcb, 0x00, 0x20);
    await testCodeEmit("sla (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x20);
    await testCodeEmit("sla (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x20);
    await testCodeEmit("sla (ix),c", 0xdd, 0xcb, 0x00, 0x21);
    await testCodeEmit("sla (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x21);
    await testCodeEmit("sla (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x21);
    await testCodeEmit("sla (ix),d", 0xdd, 0xcb, 0x00, 0x22);
    await testCodeEmit("sla (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x22);
    await testCodeEmit("sla (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x22);
    await testCodeEmit("sla (ix),e", 0xdd, 0xcb, 0x00, 0x23);
    await testCodeEmit("sla (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x23);
    await testCodeEmit("sla (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x23);
    await testCodeEmit("sla (ix),h", 0xdd, 0xcb, 0x00, 0x24);
    await testCodeEmit("sla (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x24);
    await testCodeEmit("sla (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x24);
    await testCodeEmit("sla (ix),l", 0xdd, 0xcb, 0x00, 0x25);
    await testCodeEmit("sla (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x25);
    await testCodeEmit("sla (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x25);
    await testCodeEmit("sla (ix)", 0xdd, 0xcb, 0x00, 0x26);
    await testCodeEmit("sla (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x26);
    await testCodeEmit("sla (ix-#08)", 0xdd, 0xcb, 0xf8, 0x26);
    await testCodeEmit("sla (ix),a", 0xdd, 0xcb, 0x00, 0x27);
    await testCodeEmit("sla (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x27);
    await testCodeEmit("sla (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x27);

    await testCodeEmit("sla (iy),b", 0xfd, 0xcb, 0x00, 0x20);
    await testCodeEmit("sla (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x20);
    await testCodeEmit("sla (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x20);
    await testCodeEmit("sla (iy),c", 0xfd, 0xcb, 0x00, 0x21);
    await testCodeEmit("sla (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x21);
    await testCodeEmit("sla (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x21);
    await testCodeEmit("sla (iy),d", 0xfd, 0xcb, 0x00, 0x22);
    await testCodeEmit("sla (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x22);
    await testCodeEmit("sla (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x22);
    await testCodeEmit("sla (iy),e", 0xfd, 0xcb, 0x00, 0x23);
    await testCodeEmit("sla (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x23);
    await testCodeEmit("sla (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x23);
    await testCodeEmit("sla (iy),h", 0xfd, 0xcb, 0x00, 0x24);
    await testCodeEmit("sla (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x24);
    await testCodeEmit("sla (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x24);
    await testCodeEmit("sla (iy),l", 0xfd, 0xcb, 0x00, 0x25);
    await testCodeEmit("sla (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x25);
    await testCodeEmit("sla (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x25);
    await testCodeEmit("sla (iy)", 0xfd, 0xcb, 0x00, 0x26);
    await testCodeEmit("sla (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x26);
    await testCodeEmit("sla (iy-#08)", 0xfd, 0xcb, 0xf8, 0x26);
    await testCodeEmit("sla (iy),a", 0xfd, 0xcb, 0x00, 0x27);
    await testCodeEmit("sla (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x27);
    await testCodeEmit("sla (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x27);
  });

  it("sra: indexed instructions", async () => {
    await testCodeEmit("sra (ix),b", 0xdd, 0xcb, 0x00, 0x28);
    await testCodeEmit("sra (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x28);
    await testCodeEmit("sra (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x28);
    await testCodeEmit("sra (ix),c", 0xdd, 0xcb, 0x00, 0x29);
    await testCodeEmit("sra (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x29);
    await testCodeEmit("sra (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x29);
    await testCodeEmit("sra (ix),d", 0xdd, 0xcb, 0x00, 0x2a);
    await testCodeEmit("sra (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x2a);
    await testCodeEmit("sra (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x2a);
    await testCodeEmit("sra (ix),e", 0xdd, 0xcb, 0x00, 0x2b);
    await testCodeEmit("sra (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x2b);
    await testCodeEmit("sra (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x2b);
    await testCodeEmit("sra (ix),h", 0xdd, 0xcb, 0x00, 0x2c);
    await testCodeEmit("sra (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x2c);
    await testCodeEmit("sra (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x2c);
    await testCodeEmit("sra (ix),l", 0xdd, 0xcb, 0x00, 0x2d);
    await testCodeEmit("sra (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x2d);
    await testCodeEmit("sra (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x2d);
    await testCodeEmit("sra (ix)", 0xdd, 0xcb, 0x00, 0x2e);
    await testCodeEmit("sra (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x2e);
    await testCodeEmit("sra (ix-#08)", 0xdd, 0xcb, 0xf8, 0x2e);
    await testCodeEmit("sra (ix),a", 0xdd, 0xcb, 0x00, 0x2f);
    await testCodeEmit("sra (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x2f);
    await testCodeEmit("sra (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x2f);

    await testCodeEmit("sra (iy),b", 0xfd, 0xcb, 0x00, 0x28);
    await testCodeEmit("sra (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x28);
    await testCodeEmit("sra (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x28);
    await testCodeEmit("sra (iy),c", 0xfd, 0xcb, 0x00, 0x29);
    await testCodeEmit("sra (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x29);
    await testCodeEmit("sra (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x29);
    await testCodeEmit("sra (iy),d", 0xfd, 0xcb, 0x00, 0x2a);
    await testCodeEmit("sra (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x2a);
    await testCodeEmit("sra (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x2a);
    await testCodeEmit("sra (iy),e", 0xfd, 0xcb, 0x00, 0x2b);
    await testCodeEmit("sra (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x2b);
    await testCodeEmit("sra (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x2b);
    await testCodeEmit("sra (iy),h", 0xfd, 0xcb, 0x00, 0x2c);
    await testCodeEmit("sra (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x2c);
    await testCodeEmit("sra (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x2c);
    await testCodeEmit("sra (iy),l", 0xfd, 0xcb, 0x00, 0x2d);
    await testCodeEmit("sra (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x2d);
    await testCodeEmit("sra (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x2d);
    await testCodeEmit("sra (iy)", 0xfd, 0xcb, 0x00, 0x2e);
    await testCodeEmit("sra (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x2e);
    await testCodeEmit("sra (iy-#08)", 0xfd, 0xcb, 0xf8, 0x2e);
    await testCodeEmit("sra (iy),a", 0xfd, 0xcb, 0x00, 0x2f);
    await testCodeEmit("sra (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x2f);
    await testCodeEmit("sra (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x2f);
  });

  it("sll: indexed instructions", async () => {
    await testCodeEmit("sll (ix),b", 0xdd, 0xcb, 0x00, 0x30);
    await testCodeEmit("sll (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x30);
    await testCodeEmit("sll (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x30);
    await testCodeEmit("sll (ix),c", 0xdd, 0xcb, 0x00, 0x31);
    await testCodeEmit("sll (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x31);
    await testCodeEmit("sll (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x31);
    await testCodeEmit("sll (ix),d", 0xdd, 0xcb, 0x00, 0x32);
    await testCodeEmit("sll (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x32);
    await testCodeEmit("sll (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x32);
    await testCodeEmit("sll (ix),e", 0xdd, 0xcb, 0x00, 0x33);
    await testCodeEmit("sll (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x33);
    await testCodeEmit("sll (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x33);
    await testCodeEmit("sll (ix),h", 0xdd, 0xcb, 0x00, 0x34);
    await testCodeEmit("sll (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x34);
    await testCodeEmit("sll (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x34);
    await testCodeEmit("sll (ix),l", 0xdd, 0xcb, 0x00, 0x35);
    await testCodeEmit("sll (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x35);
    await testCodeEmit("sll (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x35);
    await testCodeEmit("sll (ix)", 0xdd, 0xcb, 0x00, 0x36);
    await testCodeEmit("sll (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x36);
    await testCodeEmit("sll (ix-#08)", 0xdd, 0xcb, 0xf8, 0x36);
    await testCodeEmit("sll (ix),a", 0xdd, 0xcb, 0x00, 0x37);
    await testCodeEmit("sll (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x37);
    await testCodeEmit("sll (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x37);

    await testCodeEmit("sll (iy),b", 0xfd, 0xcb, 0x00, 0x30);
    await testCodeEmit("sll (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x30);
    await testCodeEmit("sll (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x30);
    await testCodeEmit("sll (iy),c", 0xfd, 0xcb, 0x00, 0x31);
    await testCodeEmit("sll (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x31);
    await testCodeEmit("sll (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x31);
    await testCodeEmit("sll (iy),d", 0xfd, 0xcb, 0x00, 0x32);
    await testCodeEmit("sll (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x32);
    await testCodeEmit("sll (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x32);
    await testCodeEmit("sll (iy),e", 0xfd, 0xcb, 0x00, 0x33);
    await testCodeEmit("sll (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x33);
    await testCodeEmit("sll (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x33);
    await testCodeEmit("sll (iy),h", 0xfd, 0xcb, 0x00, 0x34);
    await testCodeEmit("sll (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x34);
    await testCodeEmit("sll (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x34);
    await testCodeEmit("sll (iy),l", 0xfd, 0xcb, 0x00, 0x35);
    await testCodeEmit("sll (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x35);
    await testCodeEmit("sll (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x35);
    await testCodeEmit("sll (iy)", 0xfd, 0xcb, 0x00, 0x36);
    await testCodeEmit("sll (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x36);
    await testCodeEmit("sll (iy-#08)", 0xfd, 0xcb, 0xf8, 0x36);
    await testCodeEmit("sll (iy),a", 0xfd, 0xcb, 0x00, 0x37);
    await testCodeEmit("sll (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x37);
    await testCodeEmit("sll (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x37);
  });

  it("srl: indexed instructions", async () => {
    await testCodeEmit("srl (ix),b", 0xdd, 0xcb, 0x00, 0x38);
    await testCodeEmit("srl (ix+#0A),b", 0xdd, 0xcb, 0x0a, 0x38);
    await testCodeEmit("srl (ix-#08),b", 0xdd, 0xcb, 0xf8, 0x38);
    await testCodeEmit("srl (ix),c", 0xdd, 0xcb, 0x00, 0x39);
    await testCodeEmit("srl (ix+#0A),c", 0xdd, 0xcb, 0x0a, 0x39);
    await testCodeEmit("srl (ix-#08),c", 0xdd, 0xcb, 0xf8, 0x39);
    await testCodeEmit("srl (ix),d", 0xdd, 0xcb, 0x00, 0x3a);
    await testCodeEmit("srl (ix+#0A),d", 0xdd, 0xcb, 0x0a, 0x3a);
    await testCodeEmit("srl (ix-#08),d", 0xdd, 0xcb, 0xf8, 0x3a);
    await testCodeEmit("srl (ix),e", 0xdd, 0xcb, 0x00, 0x3b);
    await testCodeEmit("srl (ix+#0A),e", 0xdd, 0xcb, 0x0a, 0x3b);
    await testCodeEmit("srl (ix-#08),e", 0xdd, 0xcb, 0xf8, 0x3b);
    await testCodeEmit("srl (ix),h", 0xdd, 0xcb, 0x00, 0x3c);
    await testCodeEmit("srl (ix+#0A),h", 0xdd, 0xcb, 0x0a, 0x3c);
    await testCodeEmit("srl (ix-#08),h", 0xdd, 0xcb, 0xf8, 0x3c);
    await testCodeEmit("srl (ix),l", 0xdd, 0xcb, 0x00, 0x3d);
    await testCodeEmit("srl (ix+#0A),l", 0xdd, 0xcb, 0x0a, 0x3d);
    await testCodeEmit("srl (ix-#08),l", 0xdd, 0xcb, 0xf8, 0x3d);
    await testCodeEmit("srl (ix)", 0xdd, 0xcb, 0x00, 0x3e);
    await testCodeEmit("srl (ix+#0A)", 0xdd, 0xcb, 0x0a, 0x3e);
    await testCodeEmit("srl (ix-#08)", 0xdd, 0xcb, 0xf8, 0x3e);
    await testCodeEmit("srl (ix),a", 0xdd, 0xcb, 0x00, 0x3f);
    await testCodeEmit("srl (ix+#0A),a", 0xdd, 0xcb, 0x0a, 0x3f);
    await testCodeEmit("srl (ix-#08),a", 0xdd, 0xcb, 0xf8, 0x3f);

    await testCodeEmit("srl (iy),b", 0xfd, 0xcb, 0x00, 0x38);
    await testCodeEmit("srl (iy+#0A),b", 0xfd, 0xcb, 0x0a, 0x38);
    await testCodeEmit("srl (iy-#08),b", 0xfd, 0xcb, 0xf8, 0x38);
    await testCodeEmit("srl (iy),c", 0xfd, 0xcb, 0x00, 0x39);
    await testCodeEmit("srl (iy+#0A),c", 0xfd, 0xcb, 0x0a, 0x39);
    await testCodeEmit("srl (iy-#08),c", 0xfd, 0xcb, 0xf8, 0x39);
    await testCodeEmit("srl (iy),d", 0xfd, 0xcb, 0x00, 0x3a);
    await testCodeEmit("srl (iy+#0A),d", 0xfd, 0xcb, 0x0a, 0x3a);
    await testCodeEmit("srl (iy-#08),d", 0xfd, 0xcb, 0xf8, 0x3a);
    await testCodeEmit("srl (iy),e", 0xfd, 0xcb, 0x00, 0x3b);
    await testCodeEmit("srl (iy+#0A),e", 0xfd, 0xcb, 0x0a, 0x3b);
    await testCodeEmit("srl (iy-#08),e", 0xfd, 0xcb, 0xf8, 0x3b);
    await testCodeEmit("srl (iy),h", 0xfd, 0xcb, 0x00, 0x3c);
    await testCodeEmit("srl (iy+#0A),h", 0xfd, 0xcb, 0x0a, 0x3c);
    await testCodeEmit("srl (iy-#08),h", 0xfd, 0xcb, 0xf8, 0x3c);
    await testCodeEmit("srl (iy),l", 0xfd, 0xcb, 0x00, 0x3d);
    await testCodeEmit("srl (iy+#0A),l", 0xfd, 0xcb, 0x0a, 0x3d);
    await testCodeEmit("srl (iy-#08),l", 0xfd, 0xcb, 0xf8, 0x3d);
    await testCodeEmit("srl (iy)", 0xfd, 0xcb, 0x00, 0x3e);
    await testCodeEmit("srl (iy+#0A)", 0xfd, 0xcb, 0x0a, 0x3e);
    await testCodeEmit("srl (iy-#08)", 0xfd, 0xcb, 0xf8, 0x3e);
    await testCodeEmit("srl (iy),a", 0xfd, 0xcb, 0x00, 0x3f);
    await testCodeEmit("srl (iy+#0A),a", 0xfd, 0xcb, 0x0a, 0x3f);
    await testCodeEmit("srl (iy-#08),a", 0xfd, 0xcb, 0xf8, 0x3f);
  });

  it("shift/rotate: fails with invalid operand", async () => {
    await codeRaisesError("rlc a,b", "Z0604");
    await codeRaisesError("rlc (de)", "Z0604");
    await codeRaisesError("rlc -1,b", "Z0604");
    await codeRaisesError("rlc (ix),bc", "Z0604");
    await codeRaisesError("rrc a,b", "Z0604");
    await codeRaisesError("rrc (de)", "Z0604");
    await codeRaisesError("rrc -1,b", "Z0604");
    await codeRaisesError("rrc (ix),bc", "Z0604");
    await codeRaisesError("rl a,b", "Z0604");
    await codeRaisesError("rl (de)", "Z0604");
    await codeRaisesError("rl -1,b", "Z0604");
    await codeRaisesError("rl (ix),bc", "Z0604");
    await codeRaisesError("rr a,b", "Z0604");
    await codeRaisesError("rr (de)", "Z0604");
    await codeRaisesError("rr -1,b", "Z0604");
    await codeRaisesError("rr (ix),bc", "Z0604");
    await codeRaisesError("sla a,b", "Z0604");
    await codeRaisesError("sla (de)", "Z0604");
    await codeRaisesError("sla -1,b", "Z0604");
    await codeRaisesError("sla (ix),bc", "Z0604");
    await codeRaisesError("sra a,b", "Z0604");
    await codeRaisesError("sra (de)", "Z0604");
    await codeRaisesError("sra -1,b", "Z0604");
    await codeRaisesError("sra (ix),bc", "Z0604");
    await codeRaisesError("sll a,b", "Z0604");
    await codeRaisesError("sll (de)", "Z0604");
    await codeRaisesError("sll -1,b", "Z0604");
    await codeRaisesError("sll (ix),bc", "Z0604");
    await codeRaisesError("srl a,b", "Z0604");
    await codeRaisesError("srl (de)", "Z0604");
    await codeRaisesError("srl -1,b", "Z0604");
    await codeRaisesError("srl (ix),bc", "Z0604");
  });
});
