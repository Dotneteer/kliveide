<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/kliveide/assets/css/semantic.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/kliveide/assets/css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i" rel="stylesheet">

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>The Testing Process | Klive IDE</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="The Testing Process" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Testing Process" />
<meta property="og:description" content="The Testing Process" />
<link rel="canonical" href="http://localhost:4000/kliveide/documents/unit-testing-process" />
<meta property="og:url" content="http://localhost:4000/kliveide/documents/unit-testing-process" />
<meta property="og:site_name" content="Klive IDE" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-05T00:00:00+01:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/kliveide/documents/unit-testing-process","headline":"The Testing Process","dateModified":"2019-01-05T00:00:00+01:00","datePublished":"2019-01-05T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/kliveide/documents/unit-testing-process"},"description":"The Testing Process","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- Header -->
    <div class="ui vertical stripe segment with-header-back">
      <div class="ui container high">
        <h1 class="ui header">Klive IDE</h1>
        <h3 class="ui header">Full-fledged ZX Spectrum IDE with Electron, VS Code</h2>
      </div>
    </div>

    <!-- Menu -->
    <div class="ui vertical stripe segment with-menu-back">
      <div class="ui container">
        <div class="ui menu with-menu-back">
          <a class="item" href="/kliveide/">Home</a>
          <a class=" item" href="/kliveide/getting-started/install-kliveide.html">Getting Started</a>
          <a class=" active  item" href="/kliveide/documents/main-features.html">Documents</a>
          <a class="item" href="/kliveide/spectrum/basic-toc.html">ZX Spectrum</a>
          <a class="item" target="_blank" href="https://github.com/Dotneteer/kliveide">GitHub</a>
        </div>
      </div>
    </div>

    <div class="ui vertical stripe segment with-content-back">
      <div class="ui container">
        <div class="ui grid">
          <div class="three wide computer sixteen wide mobile column">
            <div class="document-list">
              
              
              
              
              
                
                  
                  
                  
                  
                  <div class="document-category  collapsed " onclick="handleClick(this)">
                    <span class="category-name">Z80 Assembler</span>
                    <div class="extender  collapsed ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  hidden ">
                  
                    
                  
                    
                    <a id="main-features" class="" href="/kliveide/documents/main-features#article">Main Features</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="how-assembler-works" class="" href="/kliveide/documents/how-assembler-works#article">How the assembler works</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                    <a id="language-structure" class="" href="/kliveide/documents/language-structure#article">Language structure</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="labels" class="" href="/kliveide/documents/labels-and-symbols#article">Labels and Symbols</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="expressions" class="" href="/kliveide/documents/expressions#article">Expressions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="instructions" class="" href="/kliveide/documents/z80-instructions#article">Z80 Instructions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="pragmas" class="" href="/kliveide/documents/pragmas#article">Pragmas</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="statements" class="" href="/kliveide/documents/statements#article">Statements</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="macros" class="" href="/kliveide/documents/macros#article">Macros</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="directives" class="" href="/kliveide/documents/directives#article">Directives</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="modules" class="" href="/kliveide/documents/modules#article">Modules</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="structs" class="" href="/kliveide/documents/structs#article">Structures</a>
                      
                      
                      
                    
                  
                    
                    <a id="assembler-output" class="" href="/kliveide/documents/assembler-output#article">Assembler Output</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                
                  
                  
                  
                  
                  <div class="document-category  collapsed " onclick="handleClick(this)">
                    <span class="category-name">Tool Commands</span>
                    <div class="extender  collapsed ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  hidden ">
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="tool-overview" class="" href="/kliveide/documents/tool-overview#article">Overview</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="memory-commands" class="" href="/kliveide/documents/common-commands#article">Common Commands</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="memory-section-commands" class="" href="/kliveide/documents/memory-section-commands#article">Disassembly: Memory Sections</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="annotation-commands" class="" href="/kliveide/documents/annotation-commands#article">Disassembly: Annotations</a>
                      
                      
                      
                    
                  
                    
                    <a id="breakpoint-commands" class="" href="/kliveide/documents/breakpoint-commands#article">Disassembly: Breakpoints</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="miscellaneous-commands" class="" href="/kliveide/documents/miscellaneous-commands#article">Disassembly: Miscellaneous</a>
                      
                      
                      
                    
                  
                    
                    <a id="watch-commands" class="" href="/kliveide/documents/tape-explorer-commands#article">Tape Explorer Commands</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="watch-commands" class="" href="/kliveide/documents/watch-commands#article">Watch Commands</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="watch-expressions" class="" href="/kliveide/documents/watch-expressions#article">Watch Expressions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                    <a id="watch-samples" class="" href="/kliveide/documents/watch-samples#article">Watch Samples</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                
                  
                  
                  
                  
                  <div class="document-category  collapsed " onclick="handleClick(this)">
                    <span class="category-name">Scripting</span>
                    <div class="extender  collapsed ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  hidden ">
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-overview" class="" href="/kliveide/documents/scripting-overview#article">Overview</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-object-model" class="" href="/kliveide/documents/scripting-object-model#article">Scripting Object Model</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-vms" class="" href="/kliveide/documents/scripting-vms#article">Managing Virtual machines</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-z80" class="" href="/kliveide/documents/scripting-z80#article">Scripting the Z80 CPU</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-screen" class="" href="/kliveide/documents/scripting-screen#article">Scripting the Screen</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-memory" class="" href="/kliveide/documents/scripting-memory#article">Scripting the Memory</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-audio" class="" href="/kliveide/documents/scripting-audio#article">Scripting the Audio</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                  <div class="document-category  expanded " onclick="handleClick(this)">
                    <span class="category-name">Unit Testing</span>
                    <div class="extender  expanded ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  displayed ">
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-basics" class="" href="/kliveide/documents/unit-testing-basics#article">Syntax Basics</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-expressions" class="" href="/kliveide/documents/unit-testing-expressions#article">Expressions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-details" class="" href="/kliveide/documents/unit-testing-details#article">Detailed Syntax</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-process" class=" active " href="/kliveide/documents/unit-testing-process#article">The Testing Process</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                
            </div>
          </div>
          <div class="thirteen wide computer sixteen wide mobile column with-main-back">
            <div id="#article" class="main-title-area">
              <h1>Unit Testing &raquo; The Testing Process</h1>
            </div>
            <div class="main-content-area">
              <h1 id="the-testing-process">The Testing Process</h1>

<p>You already learned that tests are organized into a hierarchy of <em>test files</em>, <em>test sets</em>, <em>tests</em>, and parameterized
<em>test cases</em>. In this section you will learn how the test engine manages these tests.</p>

<p>The testing process start with the compilation of tests. During this step, all tests are turned into execution plans.
If there is any compilation error, the engine won’t start running the tests.</p>

<p>The unit of execution is the <strong>test set</strong>. Test sets are entirelly independent of each other. You can run them in any
sequence; the order won’t change whether they fail or succeed. SpectNetIde loops through all test files declared in the
project (you cannot assume deterministic order), and runs all test sets in their declaration order within a file.</p>

<p>Each test sets creates and starts a Spectrum virtual machine, and pauses it when the machine reaches its main execution 
cycle. The point a machine is paused depends on its type (different for Spectrum 48K, 128K, +3E), and also the mode the machine
runs. For example, in a Spectrum 128K machine you can run tests in BASIC 128 mode or in Spectrum 48K mode.</p>

<blockquote>
  <p>Right now, the unit test engine supports only Spectrum 48K mode, but soon you will be able to use the other modes, too.</p>
</blockquote>

<h2 id="running-a-test-set">Running a Test Set</h2>

<p>Every test within a test set uses this virtual machine. This machine is paused every time a test completes 
(either successfully, with a failure, or in aborted state). <em>If a test disrupts the machine’s memory (for example, it changes
the code being tested), the behavior of a particular test may prevent the subsequent test from running properly.</em> This demeanor
of test sets is intentional.</p>

<p>The engine uses these steps to run the tests defined within a tes set:</p>

<ol>
  <li>After the Spectrum machine reaches its startup state and pauses, the engine copies the compiled source code into
the memory.</li>
  <li>If the test set declares an <code class="language-plaintext highlighter-rouge">init</code> section, the engine sets up the registers and flags accordingly, copies byte array
values into the memory. While initializing, it follows the order of <code class="language-plaintext highlighter-rouge">init</code> assignments.</li>
  <li>The engine loops through the nested <code class="language-plaintext highlighter-rouge">test</code> blocks in their declaration order, and executes them.</li>
  <li>When all tests are completed, the engine stops the virtual machine and disposes its state.</li>
</ol>

<h2 id="running-a-test-and-parameterized-cases">Running a Test and Parameterized Cases</h2>

<p>To run a single test, the engine follows these steps:</p>

<ol>
  <li>If the test has a <code class="language-plaintext highlighter-rouge">setup</code> declaration, the engine invokes the Setup code. If that code fails 
— it exceeds the timeout — the engine aborts the test.</li>
  <li>If the test has a single default case, the engine runs that case. If the test has multiple cases, 
the engine iterates through all cases in their declaration order.</li>
  <li>Provided the test has a <code class="language-plaintext highlighter-rouge">cleanup</code> section, the engine invokes the Cleanup code. If this code 
exceeds the timeout, the Cleanup code aborts the test.</li>
</ol>

<blockquote>
  <p>According to this method, it might happen that all tests run successfully and still the test is
aborted, because its Cleanup code fails. This behavior is intentional: a faulty cleanup code may influence
the subsequent tests.</p>
</blockquote>

<p>The engine carries out the same steps for a default test case and parameterized test cases. If there are 
more cases, these steps are executed in a loop:</p>

<ol>
  <li>Provided there are <code class="language-plaintext highlighter-rouge">arrange</code> declarations, the engine sets up the registers and flags accordingly, 
copies byte array values into the memory — in the order of their declaration. If any <code class="language-plaintext highlighter-rouge">arrange</code> 
assignment fails, the test is aborted.</li>
  <li>The engine invokes the <code class="language-plaintext highlighter-rouge">act</code> code. If it completes within the timeout, the testing process goes on;
otherwise, the test is aborted.</li>
  <li>If there is no <code class="language-plaintext highlighter-rouge">assert</code> section, the test is successful.</li>
  <li>If there’s an <code class="language-plaintext highlighter-rouge">assert</code> section, the engine evaluates all expresssions within until it iterates through 
all or one of the expression evaluates to false.</li>
  <li>A false assertion value completes the test as failed. If all assertions are true, the test is successful.</li>
</ol>

<h2 id="side-effects">Side effects</h2>

<p>A test can have test options (such as <code class="language-plaintext highlighter-rouge">timeout</code>, <code class="language-plaintext highlighter-rouge">di</code>, or <code class="language-plaintext highlighter-rouge">ei</code>). The engine uses these values whenever
it invokes Z80 code, independently whether that is <code class="language-plaintext highlighter-rouge">setup</code>, <code class="language-plaintext highlighter-rouge">act</code>, or <code class="language-plaintext highlighter-rouge">cleanup</code>. Between these 
code invocations, the engine simply pauses the Spectrum virtual machine and starts it again. There is one
special action the test engine takes: if a code is invoked with <code class="language-plaintext highlighter-rouge">halt</code>, the test removes the CPU from its
halted state before the next test.</p>

<blockquote>
  <p>Again, the code is injected into the virtual machine only once, at the start of a test set. If any code
changes the memory, it may disrupt the test code, and thus remaining test cases in the test set may fail of
even may be aborted. Nonetheless, these tests won’t cause any harm in your project, they just cause tests fail.</p>
</blockquote>

<p>For example, the following code disrupts the Spectrum virtual machine, because it restarts it, and so it causes
the clearing the RAM:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>testset Crashing
{
    source "../Z80CodeFiles/CodeSamples.z80asm";

    test CrashingCode
    {
        with timeout 1000;
        act call #0000;
    }
}
</code></pre></div></div>

<p>Running it will abort the test after a second.</p>

<h2 id="using-callstub">Using Callstub</h2>

<p>When you invoke the code with the <code class="language-plaintext highlighter-rouge">call</code> instruction, the test engine generates a stub
that call your subroutine. By default, the engine places three bytes with a Z80 <code class="language-plaintext highlighter-rouge">CALL</code>
instruction to the <strong><code class="language-plaintext highlighter-rouge">#5BA0</code></strong> address, that is an empty area within the ZX Spectrum system
variables (printer buffer in ZX Spectrum 48K). If you do not want to use this address for a
stub, you can change it with the <strong><code class="language-plaintext highlighter-rouge">callstub</code></strong> attribute of a test set:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>testset Introduction
{
    source "../Z80CodeFiles/CodeSamples.z80asm";
    callstub #8000;

    // --- Other test code omitted
}
</code></pre></div></div>

<p>This sample code instructs the engine to use the <strong><code class="language-plaintext highlighter-rouge">#8000</code></strong> address to generate the stub.
Be careful with using your custom stub!</p>
<ul>
  <li>First, do not forget to provide 3 bytes that the test engine can override.</li>
  <li>Second, take care that you do not declare a <code class="language-plaintext highlighter-rouge">call</code> code invocation that addresses a routine
starting at the <code class="language-plaintext highlighter-rouge">callstub</code> + 3 address. The test engine checks if your call is completed so
that it compares <strong>PC</strong> with <code class="language-plaintext highlighter-rouge">callstub</code> + 3.</li>
</ul>

<p>This is a pattern you can use with your own custom <code class="language-plaintext highlighter-rouge">callstub</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #8000

; --- Here is some code

; --- We reserve 4 bytes
CallstubAddress:
    .defs 4;
; --- SomeRoutine starts at CallstubAddress + 4
SomeRoutine:
; --- Add routine code here
</code></pre></div></div>

<p>Now, you can define a test line this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>testset Introduction
{
    source "../Z80CodeFiles/CodeSamples.z80asm";
    callstub CallstubAddress;

    test 
    {
        // ...
        act call SomeRoutine;
    }
}

</code></pre></div></div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer  -->
    <div class="ui vertical stripe segment with-header-back">
        <footer class="ui container">
          <p>&copy; Istvan Novak, 2020</p>
        </footer>
      </div>
  
    <!-- Floating return to top button -->
    <a href="javascript:" id="return-to-top">
      <span>
        <svg width="32" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16">
          <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z"/>
        </svg>
      </span>
    </a>
    
    <!-- Floating go to previous button -->
    <a href="/kliveide/documents/unit-testing-details#article" id="go-to-prev">
      <span>
        <svg width="32" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" transform="rotate(-90)">
          <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z"/>
        </svg>
      </span>
    </a>
    
    

    <script>
      window.addEventListener("scroll", function(){
        var scrolled = window.pageYOffset > 50;
        document.getElementById("return-to-top").style.display = scrolled ? "block" : "none";
        var prevEl = document.getElementById("go-to-prev");
        if (prevEl) prevEl.style.display = scrolled ? "block" : "none";
        var nextEl = document.getElementById("go-to-next");
        if (nextEl) nextEl.style.display = scrolled ? "block" : "none";
      });
      var intervalId = 0;
      var $scrollButton = document.querySelector('#return-to-top');
      function scrollStep() {
        if (window.pageYOffset === 0) {
          clearInterval(intervalId);
        }
        window.scroll(0, window.pageYOffset - 50);
      }
      function scrollToTop() {
        intervalId = setInterval(scrollStep, 6.66);
      }
      $scrollButton.addEventListener('click', scrollToTop);

      function handleClick(arg) {
        var nextEl = arg.nextElementSibling;
        var extEl = arg.children[1];
        if (arg.classList.contains("expanded")) {
          arg.classList.remove("expanded");
          arg.classList.add("collapsed");
          extEl.classList.remove("expanded");
          extEl.classList.add("collapsed");
          nextEl.classList.remove("displayed")
          nextEl.classList.add("hidden")
        } else {
          arg.classList.remove("collapsed");
          arg.classList.add("expanded");
          extEl.classList.remove("collapsed");
          extEl.classList.add("expanded");
          nextEl.classList.remove("hidden")
          nextEl.classList.add("displayed")
        }
      }
    </script>

    
  </body>
</html>