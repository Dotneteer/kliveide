<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/kliveide/assets/css/semantic.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/kliveide/assets/css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i" rel="stylesheet">

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Pragmas | Klive IDE</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Pragmas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The compiler understands several pragmas that — thought they are not Z80 instructions — they influence the emitted code. Each pragma has two alternative syntax, one with a dot prefix and another without it." />
<meta property="og:description" content="The compiler understands several pragmas that — thought they are not Z80 instructions — they influence the emitted code. Each pragma has two alternative syntax, one with a dot prefix and another without it." />
<link rel="canonical" href="http://localhost:4000/kliveide/documents/pragmas" />
<meta property="og:url" content="http://localhost:4000/kliveide/documents/pragmas" />
<meta property="og:site_name" content="Klive IDE" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-01T00:00:00+01:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Pragmas","dateModified":"2019-01-01T00:00:00+01:00","datePublished":"2019-01-01T00:00:00+01:00","url":"http://localhost:4000/kliveide/documents/pragmas","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/kliveide/documents/pragmas"},"description":"The compiler understands several pragmas that — thought they are not Z80 instructions — they influence the emitted code. Each pragma has two alternative syntax, one with a dot prefix and another without it.","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- Header -->
    <div class="ui vertical stripe segment with-header-back">
      <div class="ui container high">
        <h1 class="ui header">Klive IDE</h1>
        <h3 class="ui header">Full-fledged ZX Spectrum IDE with Electron, VS Code</h2>
      </div>
    </div>

    <!-- Menu -->
    <div class="ui vertical stripe segment with-menu-back">
      <div class="ui container">
        <div class="ui menu with-menu-back">
          <a class="item" href="/kliveide/">Home</a>
          <a class=" item" href="/kliveide/getting-started/install-kliveide.html">Getting Started</a>
          <a class=" active  item" href="/kliveide/documents/main-features.html">Documents</a>
          <a class="item" href="/kliveide/spectrum/basic-toc.html">ZX Spectrum</a>
          <a class="item" target="_blank" href="https://github.com/Dotneteer/kliveide">GitHub</a>
        </div>
      </div>
    </div>

    <div class="ui vertical stripe segment with-content-back">
      <div class="ui container">
        <div class="ui grid">
          <div class="three wide computer sixteen wide mobile column">
            <div class="document-list">
              
              
              
              
              
                
                  
                  
                  
                  
                  <div class="document-category  expanded " onclick="handleClick(this)">
                    <span class="category-name">Z80 Assembler</span>
                    <div class="extender  expanded ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  displayed ">
                  
                    
                  
                    
                    <a id="main-features" class="" href="/kliveide/documents/main-features#article">Main Features</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="how-assembler-works" class="" href="/kliveide/documents/how-assembler-works#article">How the assembler works</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                    <a id="language-structure" class="" href="/kliveide/documents/language-structure#article">Language structure</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="labels" class="" href="/kliveide/documents/labels-and-symbols#article">Labels and Symbols</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="expressions" class="" href="/kliveide/documents/expressions#article">Expressions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="instructions" class="" href="/kliveide/documents/z80-instructions#article">Z80 Instructions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="pragmas" class=" active " href="/kliveide/documents/pragmas#article">Pragmas</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="statements" class="" href="/kliveide/documents/statements#article">Statements</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="macros" class="" href="/kliveide/documents/macros#article">Macros</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="directives" class="" href="/kliveide/documents/directives#article">Directives</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="modules" class="" href="/kliveide/documents/modules#article">Modules</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="structs" class="" href="/kliveide/documents/structs#article">Structures</a>
                      
                      
                      
                    
                  
                    
                    <a id="assembler-output" class="" href="/kliveide/documents/assembler-output#article">Assembler Output</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                
                  
                  
                  
                  
                  <div class="document-category  collapsed " onclick="handleClick(this)">
                    <span class="category-name">Tool Commands</span>
                    <div class="extender  collapsed ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  hidden ">
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="tool-overview" class="" href="/kliveide/documents/tool-overview#article">Overview</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="memory-commands" class="" href="/kliveide/documents/common-commands#article">Common Commands</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="memory-section-commands" class="" href="/kliveide/documents/memory-section-commands#article">Disassembly: Memory Sections</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="annotation-commands" class="" href="/kliveide/documents/annotation-commands#article">Disassembly: Annotations</a>
                      
                      
                      
                    
                  
                    
                    <a id="breakpoint-commands" class="" href="/kliveide/documents/breakpoint-commands#article">Disassembly: Breakpoints</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="miscellaneous-commands" class="" href="/kliveide/documents/miscellaneous-commands#article">Disassembly: Miscellaneous</a>
                      
                      
                      
                    
                  
                    
                    <a id="watch-commands" class="" href="/kliveide/documents/tape-explorer-commands#article">Tape Explorer Commands</a>
                      
                      
                      
                    
                  
                    
                  
                    
                    <a id="watch-commands" class="" href="/kliveide/documents/watch-commands#article">Watch Commands</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="watch-expressions" class="" href="/kliveide/documents/watch-expressions#article">Watch Expressions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                    <a id="watch-samples" class="" href="/kliveide/documents/watch-samples#article">Watch Samples</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                
                  
                  
                  
                  
                  <div class="document-category  collapsed " onclick="handleClick(this)">
                    <span class="category-name">Scripting</span>
                    <div class="extender  collapsed ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  hidden ">
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-overview" class="" href="/kliveide/documents/scripting-overview#article">Overview</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-object-model" class="" href="/kliveide/documents/scripting-object-model#article">Scripting Object Model</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-vms" class="" href="/kliveide/documents/scripting-vms#article">Managing Virtual machines</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-z80" class="" href="/kliveide/documents/scripting-z80#article">Scripting the Z80 CPU</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-screen" class="" href="/kliveide/documents/scripting-screen#article">Scripting the Screen</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-memory" class="" href="/kliveide/documents/scripting-memory#article">Scripting the Memory</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="scripting-audio" class="" href="/kliveide/documents/scripting-audio#article">Scripting the Audio</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                  <div class="document-category  collapsed " onclick="handleClick(this)">
                    <span class="category-name">Unit Testing</span>
                    <div class="extender  collapsed ">
                      <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" >
                        <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z" />
                      </svg>
                    </div>
                  </div>
                  <div class="article-names  hidden ">
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-basics" class="" href="/kliveide/documents/unit-testing-basics#article">Syntax Basics</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-expressions" class="" href="/kliveide/documents/unit-testing-expressions#article">Expressions</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-details" class="" href="/kliveide/documents/unit-testing-details#article">Detailed Syntax</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                    <a id="unit-testing-process" class="" href="/kliveide/documents/unit-testing-process#article">The Testing Process</a>
                      
                      
                      
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                  </div>
                  
                
                  
                  
                  
                  
                
            </div>
          </div>
          <div class="thirteen wide computer sixteen wide mobile column with-main-back">
            <div id="#article" class="main-title-area">
              <h1>Z80 Assembler &raquo; Pragmas</h1>
            </div>
            <div class="main-content-area">
              <p>The compiler understands several pragmas that — thought they are not Z80 
instructions — they influence the emitted code. Each pragma has two alternative syntax,
one with a dot prefix and another without it.</p>

<p>For example, you can write <code class="highlighter-rouge">ORG</code> or <code class="highlighter-rouge">.ORG</code> to use the <strong>ORG</strong> pragma.</p>

<blockquote>
  <p>I prefer using the dot-prefixed versions of pragmas.</p>
</blockquote>

<h2 id="the-org-pragma">The ORG pragma</h2>

<p>With the <strong>ORG</strong> pragma, you define where to place the compiled Z80 code when you run it.
For example, the following line sets this location to the 0x6000 address:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #6000
</code></pre></div></div>

<p>If you do not use <strong>ORG</strong>, the default address is 0x8000.</p>

<p>You can apply multiple <strong>ORG</strong> pragmas in your source code. Each usage creates a new segment in the
assembler output. Take a look at this code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ld h,a
.org #8100
ld d,a
.org #8200
ld b,a
</code></pre></div></div>

<p>This code generates three output segment, each with one emitted byte that represents the 
corresponding <code class="highlighter-rouge">LD</code> operation. The first segment will start at 0x8000 (default), 
the second at 0x8100, whilst the third at 0x8200.</p>

<h2 id="the-xorg-pragma">The XORG pragma</h2>

<p>With the <strong>XORG</strong> pragma, you define the start address of a specific code section (the section started with the previous <code class="highlighter-rouge">.ORG</code>) to use when exporting to Intel HEX format.</p>

<p>For example, the following line sets this location to the 0x0000 address; however, the code section starts at 0x6000.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #6000
.xorg #0
</code></pre></div></div>

<p>If you try to use multiple <code class="highlighter-rouge">.XORG</code> within a code section, the assembler raises an error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #6000
.xorg #0
    ld a,b
    ; ...
.xorg #1000 ; This line will casue an error message
</code></pre></div></div>

<h2 id="the-ent-pragma">The ENT pragma</h2>

<p>The <strong>ENT</strong> pragma defines the entry code of the program when you run it from Visual Studio.
If you do not apply <strong>ENT</strong> in your code, the entry point will be the first address of the 
very first output code segment. Here’s a sample:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #6200
ld hl,#4000
.ent $
jp #6100

.org #6100
call MyCode
...
</code></pre></div></div>

<p>The <code class="highlighter-rouge">.ent $</code> pragma will sign the address of the <code class="highlighter-rouge">jp #6100</code> isntruction as the entry
address of the code. Should you omit the <strong>ENT</strong> pragma from this code, the entry point would be
0x6200, for this is the start of the very first output segment, even though there is another
segment starting at 0x6100.</p>

<h2 id="the-xent-pragma">The XENT pragma</h2>

<p>The IDE provides a command, <strong>Export Z80 Program</strong>, which allows you to create a LOAD block
that automatically starts the code. The <strong>Run Z80 Program</strong> and <strong>Debug Z80 Program</strong> command
simply jump to the address you specify with the <strong>ENT</strong> pragma. However, the auto LOAD block uses
the <strong><code class="highlighter-rouge">RANDOMIZE USR address</code></strong> pattern where you need to define a different entry address that
can be closed with a <strong><code class="highlighter-rouge">RET</code></strong> statement. The <strong>XENT</strong> pragma sets this address.
 Here’s a sample:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>start: 
	.org #8000
	.ent #8000
	call SetBorder
	jp #12ac
SetBorder:
	.xent $
	ld a,4
	out (#fe),a
	ret
</code></pre></div></div>

<p>The IDE will use #8000 — according to the <code class="highlighter-rouge">.ent #8000</code> pragma — when starting
the code with the <strong>Run Z80 Program</strong>. Nonetheless, the <strong>Export Z80 Program</strong> will offer #8006
— according to the <code class="highlighter-rouge">.xent $</code> pragma — as the startup code address.</p>

<h2 id="the-disp-pragma">The DISP pragma</h2>

<p>The <strong>DISP</strong> pragma allows you to define a displacement for the code. The value affects the
<code class="highlighter-rouge">$</code> token that represents the current assembly address. Your code is placed according 
to the <strong>ORG</strong> of the particular output segment, but the assembly address is always displaced
with the value according to <strong>DISP</strong>. Take a look at this sample:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #6000
.disp #1000
ld hl,$
</code></pre></div></div>

<p>The <code class="highlighter-rouge">ld hl,$</code> instruction will be placed to the 0x6000 address, but it will be equivalent
with the <code class="highlighter-rouge">ld hl,#7000</code> statement due to the <code class="highlighter-rouge">.disp #1000</code> displacement.</p>

<blockquote>
  <p>Of course, you can use negative displacement, too.</p>
</blockquote>

<h2 id="the-bank-pragma">The BANK pragma</h2>

<p>The ZX Spectrum 128K/2A/+2A/+3/+3E models handle 16K memory pages (banks) that can be paged into particular memory slots.
(You can find more information about this <a href="https://www.worldofspectrum.org/faq/reference/128kreference.htm">here</a>.)</p>

<p>The <strong>BANK</strong> pragma allows you to declare that you want to put the Z80 Assembly code in a specific memory bank.
When you export the compiled output, the <strong>Export program</strong> function of <strong>SpectNetIDE</strong> creates a loader that reads the 
code and places it on the specified memory page.</p>

<p>The <strong>BANK</strong> pragma accepts two parameters. The first is the bank number (so it must be between 0 and 7). The second one is
an optional offset value (between 0 and 16383), which indicates the start offset within the bank. If you omit this, the default
value is zero. By default, the SpectNetIDE assembler assumes that the start address of the code in the bank is <code class="highlighter-rouge">$C000</code>. Nonetheless,
you can specify any other value.</p>

<blockquote>
  <p><strong>Note</strong>: You need to apply the <code class="highlighter-rouge">.model Spectrum128</code> pragma at the top of your code so that you can use <code class="highlighter-rouge">.bank</code>.</p>
</blockquote>

<h3 id="using-bank-without-an-offset">Using BANK without an offset</h3>

<p>Let’s assume you have this code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.model Spectrum128
; ...
.bank 3
  call yellow
  ret
yellow:
  ld a,6
  out (#fe),a
  ret
</code></pre></div></div>

<p>The compiler emits this code (and later, the loader takes care that it goes to bank #3):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000: call #C004  ; yellow
0003: ret
0004: ld a,#06    ; this is yellow (#C004)
0006: out (#FE),a
</code></pre></div></div>

<p>The offset values at the beginning of the lines show the byte offset within the 16K memory bank.</p>

<h3 id="using-bank-with-an-offset">Using BANK with an offset</h3>

<p>Let’s modify the previous code adding an offset value:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.model Spectrum128
; ...
.bank 3, #100
  call yellow
  ret
yellow:
  ld a,6
  out (#fe),a
  ret
</code></pre></div></div>

<p>Now, the compiler emits similar code, but its starts address is #C100 (#100 away from the default #C000):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0100: call #C104  ; yellow
0103: ret
0104: ld a,#06    ; this is yellow (#C104)
0106: out (#FE),a
</code></pre></div></div>

<p>Though it seems that we’re wasting the first 256 bytes of the page, the <strong>Export program</strong> command does not output
those bytes. The loader knows that it should load the code from address #C100.</p>

<h3 id="using-bank-with-org">Using BANK with ORG</h3>

<p>Though the default address to compile the code is #C000, you can change it. For example, Bank #2 is paged into the #8000-#BFFF
memory range (slot 2), so it seems natural to use the #8000 address like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.model Spectrum128
; ...
.bank 2
.org #8000
  call yellow
  ret
yellow:
  ld a,6
  out (#fe),a
  ret
</code></pre></div></div>

<p>As you expect, this is the output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000: call #8004  ; yellow
0003: ret
0004: ld a,#06    ; this is yellow (#8004)
0006: out (#FE),a
</code></pre></div></div>

<h3 id="using-bank-with-offset-and-org">Using BANK with offset, and ORG</h3>

<p>You can combine the offset of the bank with ORG:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.bank 2, #100
.org #8000
  call yellow
  ret
yellow:
  ld a,6
  out (#fe),a
  ret
</code></pre></div></div>

<p>The output is probably different from the one you expect:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0100: call #8004  ; yellow
0103: ret
0104: ld a,#06    ; this is yellow (#8004)
0106: out (#FE),a
</code></pre></div></div>

<p>As you can see, the code stream is the same as in the previous case; however, here, the code starts at offset #100.</p>

<h3 id="using-multiple-bank-directives">Using multiple BANK directives</h3>

<p>As you may need multiple memory banks in your program, you can use multiple <code class="highlighter-rouge">BANK</code> pragmas, like in this example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.bank 1
; Here goes the code for bank #1
; ...
.bank 3
; Here goes the code for bank #3
; ...
</code></pre></div></div>

<h3 id="restrictions-with-bank">Restrictions with BANK</h3>

<ul>
  <li><code class="highlighter-rouge">BANK</code> cannot have a label.</li>
  <li><code class="highlighter-rouge">BANK</code> cannot be used with the ZX Spectrum 48 model type.</li>
  <li>The <code class="highlighter-rouge">BANK</code> value must be between 0 and 7</li>
  <li>The offset must be between 0 and 16383</li>
  <li>You can use the <code class="highlighter-rouge">BANK</code> pragma for a particular bank page only once, so, for example, the following code raises
an error message:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.bank 1
; ...

.bank 3
; ...

.bank 1 ; This line raises the error
; ...
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: This is a temporary restriction. In the future, it may be removed.</p>
</blockquote>

<h2 id="the-equ-pragma">The EQU pragma</h2>

<p>The <strong>EQU</strong> pragma allows you assign a value to an identifier. The label before <strong>EQU</strong> is the
name of the identifier (or symbol), the exression used in <strong>EQU</strong> is the value of the variable.
This is a short sample:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      .org #6200
      ld hl,Sym1
Sym1: .equ #4000
      ld bc,Sym2
Sym2: .equ $+4
</code></pre></div></div>

<p>This sample is equivalent with this one:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #6200
ld hl,#4000 ; Sym1 &lt;-- #4000
ld bc,#620a ; Sym2 &lt;-- #620a as an ld bc,NNNN operation and
                       an ld hl,NNNN each takes 3 bytes
</code></pre></div></div>

<h2 id="the-var-pragma">The VAR pragma</h2>

<p>The <strong>VAR</strong> pragma works similarly to <strong>EQU</strong>. However, while <strong>EQU</strong> does not allow using the same symbol
with mulitple value assignments, <strong>VAR</strong> assigns a new value to the symbol every time it is used.</p>

<blockquote>
  <p>The VAR pragma accepts extra syntax alternatives: <code class="highlighter-rouge">=</code>, <code class="highlighter-rouge">:=</code></p>
</blockquote>

<h2 id="the-injectopt-pragma">The INJECTOPT pragma</h2>

<p>When you run the ZX Spectrum virtual machine from the IDE with the <strong>Run program</strong> command, it injects the machine code
into the memory and sets up the system as if you started the code from BASIC with the RUN command. By default, it sets the cursor to “L” mode.
However, in several cases, you’d like to keep the cursor in “K” mode, for example, when you intend to start the code with the 
<strong>RANDOMIZE USER <em>addr</em></strong> command (here, <em>addr</em> is the entry address). In this case, you can add the INJECTOP pragma to the code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.injectopt cursork
</code></pre></div></div>

<p>The <strong>INJECTOPT</strong> pragma expects an identifier-like option tag after the starting pragma keyword, such as <code class="highlighter-rouge">cursork</code> above. Omitting that tag will cause a syntax error.</p>

<blockquote>
  <p>Though right now <strong>INJECTOPT</strong> supports only the <code class="highlighter-rouge">cursork</code> tag, it does not raise an exception with other tags, ignores them.</p>
</blockquote>

<h2 id="the-defb-pragma">The DEFB pragma</h2>

<p>The <strong>DEFB</strong> pragma emits 8-bit expressions (bytes) from the current assembly position.
here is a sample:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #6000
.defb #01, #02, $, #04
</code></pre></div></div>

<p>The <strong>DEFB</strong> pragma will emit these four bytes starting at 0x6000: 0x01, 0x02, 0x03, 0x04.
The <code class="highlighter-rouge">$</code> expression will emit 0x03, because at the emission point the current assembly
address is 0x6003. The <strong>DEFB</strong> program takes into account only the rightmost 8 bits of any
expression: this is how <code class="highlighter-rouge">$</code> results in 0x03.</p>

<blockquote>
  <p><strong>DEFB</strong> has extra syntax variants: <code class="highlighter-rouge">db</code>, <code class="highlighter-rouge">.db</code>, <code class="highlighter-rouge">DB</code>, and <code class="highlighter-rouge">.DB</code> are accepted, too.</p>
</blockquote>

<h2 id="the-defw-pragma">The DEFW pragma</h2>

<p>The <strong>DEFW</strong> pragma is similar to <strong>DEFB</strong>, but it emits 16-bit values with LSB, MSB order.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.defw #1234, #abcd
</code></pre></div></div>

<p>This simple code above will emit these four bytes: 0x34, 0x12, 0xcd, 0xab.</p>

<blockquote>
  <p><strong>DEFW</strong> has extra syntax variants: <code class="highlighter-rouge">dw</code>, <code class="highlighter-rouge">.dw</code>, <code class="highlighter-rouge">DW</code>, and <code class="highlighter-rouge">.DW</code> are accepted, too.</p>
</blockquote>

<h2 id="the-defm-pragma">The DEFM pragma</h2>

<p>The <strong>DEFM</strong> pragma emits the byte-array representation of a string. Each character
in the string is replaced with the correcponding byte. Take a look at this code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.defm "\C by me"
</code></pre></div></div>

<p>Here, the <strong>DEFM</strong> pragma emits 7 bytes for the seven characters (the first escape 
sequence represents the copyrigh sign) : 0x7f, 0x20, 0x62, 0x69, 0x20, 0x6d, 0x65.</p>

<blockquote>
  <p><strong>DEFM</strong> has extra syntax variants: <code class="highlighter-rouge">dm</code>, <code class="highlighter-rouge">.dm</code>, <code class="highlighter-rouge">DM</code>, and <code class="highlighter-rouge">.DM</code> are accepted, too.</p>
</blockquote>

<h2 id="the-defn-pragma">The DEFN pragma</h2>

<p>The <strong>DEFN</strong> pragma works just like the <code class="highlighter-rouge">DEFM</code> pragma but it emits an additional <code class="highlighter-rouge">0x00</code>
byte to terminate the string. Look at this code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.defn "\C by me"
</code></pre></div></div>

<p>Here, the <strong>DEFN</strong> pragma emits 8 bytes for the seven characters (the first escape 
sequence represents the copyrigh sign) plus the terminating zero:
0x7f, 0x20, 0x62, 0x69, 0x20, 0x6d, 0x65, 0x00.</p>

<blockquote>
  <p><strong>DEFN</strong> has extra syntax variants: <code class="highlighter-rouge">dn</code>, <code class="highlighter-rouge">.dn</code>, <code class="highlighter-rouge">DN</code>, and <code class="highlighter-rouge">.DN</code> are also accepted.</p>
</blockquote>

<h2 id="the-defc-pragma">The DEFC pragma</h2>

<p>The <strong>DEFC</strong> pragma works just like the <code class="highlighter-rouge">DEFM</code> pragma but it sets Bit 7 of the last 
emitted character. Look at this code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.defc "\C by me"
</code></pre></div></div>

<p>Here, the <strong>DEFC</strong> pragma emits 7 bytes for the seven characters (the first escape 
sequence represents the copyrigh sign) with Bit 7 of the last character (0x65) set (so it become 0xE5):
0x7f, 0x20, 0x62, 0x69, 0x20, 0x6d, 0xE5.</p>

<blockquote>
  <p><strong>DEFC</strong> has extra syntax variants: <code class="highlighter-rouge">dc</code>, <code class="highlighter-rouge">.dc</code>, <code class="highlighter-rouge">DC</code>, and <code class="highlighter-rouge">.DC</code> are also accepted.</p>
</blockquote>

<h2 id="the-defh-pragma">The DEFH pragma</h2>

<p>The <strong>DEFH</strong> pragma uses a string with even number of hexadecimal digits to emits a 
byte-array representation of the input. Each character pair in the string is replaced
with the correcponding byte. Take a look at this code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.defh "12E4afD2"
</code></pre></div></div>

<p>Here, the <strong>DEFH</strong> pragma emits 4 bytes: 0x12, 0xe4, 0xaf, 0xd2.</p>

<blockquote>
  <p><strong>DEFH</strong> has extra aliases: <code class="highlighter-rouge">dh</code>, <code class="highlighter-rouge">.dh</code>, <code class="highlighter-rouge">DH</code>, and <code class="highlighter-rouge">.DH</code>.</p>
</blockquote>

<h2 id="the-defs-pragma">The DEFS pragma</h2>

<p>You can emit zero (<code class="highlighter-rouge">0x00</code>) bytes with this pragma. It accepts a single argument,
the number of zeros to emit. This code sends 16 zeros to the generated output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.defs 16
</code></pre></div></div>

<blockquote>
  <p><strong>DEFS</strong> has extra syntax variants: <code class="highlighter-rouge">ds</code>, <code class="highlighter-rouge">.ds</code>, <code class="highlighter-rouge">DS</code>, and <code class="highlighter-rouge">.DS</code> are also accepted.</p>
</blockquote>

<h2 id="the-fillb-pragma">The FILLB pragma</h2>

<p>With <strong>FILLB</strong>, you can emit a particular count of a specific byte. The first argument
of the pragma sets the count, the second specifies the byte to emit. This code emits 24
bytes of <code class="highlighter-rouge">#A5</code> values:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.fillb 24,#a5
</code></pre></div></div>

<h2 id="the-fillw-pragma">The FILLW pragma</h2>

<p>With <strong>FILLW</strong>, you can emit a particular count of a specific 16-bit word. The first argument
of the pragma sets the count, the second specifies the word to emit. This code emits 8
words (16 bytes) of <code class="highlighter-rouge">#12A5</code> values:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.fillw 8,#12a5
</code></pre></div></div>

<p>Of course, the bytes of a word are emitted in LSB/MSB order.</p>

<h2 id="the-skip-pragma">The SKIP pragma</h2>

<p>The <strong>SKIP</strong> pragma — as its name suggests — skips the number of bytes
as specified in its argument. It fills up the skipped bytes with 0xFF.</p>

<h2 id="the-extern-pragma">The EXTERN pragma</h2>

<p>The <strong>EXTERN</strong> pragma is kept for future extension. The current compiler accepts it, but
does not do any action when observing this pragma.</p>

<h2 id="the-model-pragma">The MODEL pragma</h2>

<p>This pragma is used when you run or debug your Z80 code within the emulator. With Spectrum 128K, Spectrum +3, 
and Spectrum Next models, you can run the Z80 code in differend contexts. The <strong>MODEL</strong> pragma lets you
specify on which model you want to run the code. You can use the <code class="highlighter-rouge">SPECTRUM48</code>, <code class="highlighter-rouge">SPECTRUM128</code>, 
<code class="highlighter-rouge">SPECTRUMP3</code>, or <code class="highlighter-rouge">NEXT</code> identifiers to choose the model (identifiers are case-insensitive):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.model Spectrum48
.model Spectrum128
.model SpectrumP3
.model Next
</code></pre></div></div>

<p>For example, when you create code for Spectrum 128K, and add the <code class="highlighter-rouge">.model Spectrum48</code> pragma to the code,
the <strong>Run Z80 Code</strong> command will start the virtual machine, turns the machine into Spectrum 48K mode, and ignites
the code just after that.</p>

<p><em>Note</em>: With the <code class="highlighter-rouge">#ifmod</code> and <code class="highlighter-rouge">#ifnmod</code> directives, you can check the model type. For example, the following
Z80 code results green background on Spectrum 48K, cyan an Spectrum 128K:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    .model Spectrum48

#ifmod Spectrum128
    BorderColor: .equ 5
    RetAddr: .equ #2604
#else
    BorderColor: .equ 4
    RetAddr: .equ #12a2
#endif

Start:
    .org #8000
    ld a,BorderColor
    out (#fe),a
    jp RetAddr
</code></pre></div></div>

<h2 id="the-align-pragma">The ALIGN pragma</h2>

<p>This pragma allows you to align the current assembly counter to the specified byte boundary. 
You can use this pragma with an optional expression. Look at these samples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.org #8000
    nop
.align 4
    nop
.align
</code></pre></div></div>

<p>The first pragma aligns the assembly counter to #8004, as this one is the next 4-byte boundary.
With no value specified, <code class="highlighter-rouge">.align</code> uses #100, and thus the second <code class="highlighter-rouge">.align</code> in the sample sets
the current assembly counter to the next page boundary, #8100.</p>

<h2 id="the-trace-and-tracehex-pragmas">The TRACE and TRACEHEX pragmas</h2>

<p>These pragmas send trace information to the assembler output. In the Visual Studio IDE, these
messages are displayed in the Z80 Build Output window pane. You can list one or more expressions 
separated by a comma after the <code class="highlighter-rouge">.trace</code> token. TRACEHEX works just like TRACE, but id displays 
integer numbers and strings in hexadecimal format.</p>

<p>Let’assume, you add these lines to the source code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.trace "Hello, this is: ", 42
.tracehex "Hello, this is: ", 42
</code></pre></div></div>

<p>When you compile the source, the lines above display these messages:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TRACE: Hello, this is: 42
TRACE: 48656C6C6F2C20746869732069733A20002A
</code></pre></div></div>

<h2 id="the-rndseed-pragma">The RNDSEED pragma</h2>

<p>With the <code class="highlighter-rouge">rnd()</code> function, you can generate random numbers. The RNDSEED pragma sets the seed
value to use for random number generation. If you use this pragma with an integer expression,
the seed is set to tha value of that expression. If you do not provide the expression, the compiler
uses the system clock to set up the seed.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.rndseed ; sets the seed according to the system clock
.rndseed 123 ; sets the seed to 123
</code></pre></div></div>

<h2 id="the-defgx-pragma">The DEFGX pragma</h2>

<p>This pragma helps you define bitmaps in the code. This pragma excepts a string expression 
and utilizes that string as a pattern to generate bytes for the bitmap.</p>

<blockquote>
  <p><strong>DEFGX</strong> has extra syntax variants: <code class="highlighter-rouge">dgx</code>, <code class="highlighter-rouge">.dgx</code>, <code class="highlighter-rouge">DGX</code>, and <code class="highlighter-rouge">.DGX</code> are accepted, too.</p>
</blockquote>

<p>If the very first character of the string pattern is <code class="highlighter-rouge">&lt;</code>, the pattern is left aligned, 
and starts with the second character. Should the first character be <code class="highlighter-rouge">&gt;</code>, the pattern is 
right aligned and starts with the second character. By default, (if no <code class="highlighter-rouge">&lt;</code> or <code class="highlighter-rouge">&gt;</code> is used)
the pattern is left-aligned.</p>

<p>Any space within the pattern are ignored, taken into account as helpers. Other characters
are converted into bits one-by-one.</p>

<p>Before the conversion, the pragma checks if the pattern constitutes multiples of 8 bits.
If not, it uses zero bit prefixes (right-aligned), or zero-bit suffixes (left-aligned)
so that the pattern would be adjusted to contain entire bytes.</p>

<p>The <code class="highlighter-rouge">.</code> (dot), <code class="highlighter-rouge">-</code> (dash), and <code class="highlighter-rouge">_</code> (underscore) sign 0, any other characters stand for 1. 
Every 8 bits in the pattern emit a byte.</p>

<p>Here are a few samples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.dg "....OOOO"         ; #0F
.dg "&gt;....OOOO"        ; #0F
.dg "&lt;----OOOO"        ; #0F
.dg "___OOOO"          ; #1E
.dg "....OOOO ..OO"    ; #0F, #30
.dg "&gt;....OO OO..OOOO" ; #03, #CF
</code></pre></div></div>

<h2 id="the-defg-pragma">The DEFG pragma</h2>

<p>This pragma helps you define bitmaps in the code. This pragma excepts a string pattern (<em>note: not a string expression!</em>) 
and utilizes that string as a pattern to generate bytes for the bitmap.</p>

<blockquote>
  <p><strong>DEFG</strong> has extra syntax variants: <code class="highlighter-rouge">dg</code>, <code class="highlighter-rouge">.dg</code>, <code class="highlighter-rouge">DG</code>, and <code class="highlighter-rouge">.DG</code> are also accepted.</p>
</blockquote>

<p>Any space within the pattern are ignored, taken into account as helpers. Other characters
are converted into bits one-by-one. The pixels in a byte are planted with the LHS as the 
most-significant bit, and multiple bytes are planted LHS byte first.</p>

<p>The <code class="highlighter-rouge">.</code> (dot), <code class="highlighter-rouge">-</code> (dash), and <code class="highlighter-rouge">_</code> (underscore) sign 0, any other characters stand for 1. 
Every 8 bits in the pattern emit a byte.</p>

<p>Here are a few samples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.dg ....OOOO        ; #0F
.dg ___OOOO         ; #1E
.dg ....OOOO ..OO"  ; #0F, #30
.dg ....OO OO..OOOO ; #0F, #3C
</code></pre></div></div>

<blockquote>
  <p>Please note, unlinke in the pattern used with <code class="highlighter-rouge">DEFGX</code>, here, the leading <code class="highlighter-rouge">&gt;</code> and <code class="highlighter-rouge">&lt;</code> characters 
are taken as bit 1. They do not specify bit alignment.</p>
</blockquote>

<h2 id="the-error-pragma">The ERROR Pragma</h2>

<p>You can raise custom error messages with this pragma. <strong>ERROR</strong> accepts an expression
and displays an error message with code <code class="highlighter-rouge">Z0500</code> using the text you provide. Here is a sample:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.error "The value must be greater than" + str(minvalue)
</code></pre></div></div>

<h2 id="the-includebin-pragma">The INCLUDEBIN Pragma</h2>

<p>You can include a binary file into the source code to emit all bytes just as if you used the 
<code class="highlighter-rouge">.defb</code> pragma. You can include the entire file, or a single segment of it. The pragma has a 
mandatory argument — the name of the binary file to include — and two optional 
ones, the start offset of the segment, and its length, respectively. Let’s see a few examples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.includebin "./myfile.bin"
.includebin "./myfile.bin" 2
.includebin "./myfile.bin" 2, 3
</code></pre></div></div>

<p>This snippet loads the <code class="highlighter-rouge">myfile.bin</code> file from the same directory that contains the source 
with the <code class="highlighter-rouge">.includebin</code> directive.</p>

<p>Let’s assume that <code class="highlighter-rouge">myfile.bin</code> contains these bytes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#00, #01, #02, #03, #04, #05, #06, #07 
</code></pre></div></div>

<p>The three lines of code above are the same as if we had written these code lines:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.defb #00, #01, #02, #03, #04, #05, #06, #07 ; .includebin "./myfile.bin"
.defb #02, #03, #04, #05, #06, #07           ; .includebin "./myfile.bin" 2
.defb #02, #03, #04                          ; .includebin "./myfile.bin" 2, 3
</code></pre></div></div>

<blockquote>
  <p>Of course, the compiler does not allow negative file offset or length. It alse raises
an error if you define a segment that does not fit into the binary file.<br />
You can use alternative syntax for <code class="highlighter-rouge">.includebin</code>. The compiler accepts these tokens and their
uppercase versions, too: <code class="highlighter-rouge">includebin</code>, <code class="highlighter-rouge">.include_bin</code>, and <code class="highlighter-rouge">include_bin</code>.</p>
</blockquote>

<h2 id="the-comparebin-pragma">The COMPAREBIN pragma</h2>

<p>When you are re-engineering a Z80 program from an exported disassembly, it is good to know that you do not break the original code. The <code class="highlighter-rouge">.comparebin</code> pragma helps you to check that you still compile what you expect. It loads a binary file and compares that file with the output of the current code segment.</p>

<p>The pragma has a mandatory argument — the name of the binary file to include — and two optional ones, the start offset of the segment, and its length, respectively. Let’s see a few examples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.comparebin "./myfile.bin"
.comparebin "./myfile.bin" 2
.comparebin "./myfile.bin" 2, 3
</code></pre></div></div>

<blockquote>
  <p>Of course, the compiler does not allow negative file offset or length. It also raises an error if you define a segment that does not fit into the binary file.<br />
You can use alternative syntax for <code class="highlighter-rouge">.comparebin</code>. The compiler accepts these tokens, too: <code class="highlighter-rouge">comparebin</code>, <code class="highlighter-rouge">.COMPAREBIN</code>, and <code class="highlighter-rouge">COMPAREBIN</code>.</p>
</blockquote>

<p>When you compile the code, every <code class="highlighter-rouge">.org</code> pragma opens a new segment that starts from the point defined by <code class="highlighter-rouge">.org</code>.</p>

<p>You can put it into the code in as many places as you want. As the compiler parses the code, it records the positions of <code class="highlighter-rouge">.comparebin</code> pragmas, the current output segment and its length at the point where <code class="highlighter-rouge">.comparebin</code> is used. When the code compilation is ready — and there are no errors —, the compiler executes a check.
This check compares the emitted bytes with the recorded length to the bytes in the binary file.</p>

<ul>
  <li>If the length of the segment is greater than the size of the file, the compiler raises an error.</li>
  <li>The comparison checks only the as many bytes as are in the output segment; if there are more bytes in the binary file, the remaining data is ignored.</li>
  <li>If the compared data do not match, the assembler raises an error with the first unmatching position.</li>
</ul>

<p>Let’s assume, we have the <code class="highlighter-rouge">origin.bin</code> file that contains these six bytes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#00, #01, #02, #03, #04, #05
</code></pre></div></div>

<p>Take a look at this code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  .org #8000
  .defb #00, #01, #02
  .comparebin "origin.bin"

  .org #8100
  .defb #03, #04, #05
  .comparebin "origin.bin"
  .comparebin "origin.bin", 3
</code></pre></div></div>

<p>This code contains two segments (it has two <code class="highlighter-rouge">.org</code> pragmas) and three <code class="highlighter-rouge">.comparebin</code>.</p>

<ul>
  <li>Though <code class="highlighter-rouge">origin.bin</code> has six bytes, the first comparison succeeds, as it utilizes only the three bytes emitted in the first segment.</li>
  <li>The second comparison fails, as the file starts with #00, #01, #02, while the segment emits #03, #04, and #05.</li>
  <li>The third comparison succeeds, as it starts the examination from the 4th byte (offset 3) of the binary file.</li>
</ul>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer  -->
    <div class="ui vertical stripe segment with-header-back">
        <footer class="ui container">
          <p>&copy; Istvan Novak, 2020</p>
        </footer>
      </div>
  
    <!-- Floating return to top button -->
    <a href="javascript:" id="return-to-top">
      <span>
        <svg width="32" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16">
          <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z"/>
        </svg>
      </span>
    </a>
    
    <!-- Floating go to previous button -->
    <a href="/kliveide/documents/z80-instructions#article" id="go-to-prev">
      <span>
        <svg width="32" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" transform="rotate(-90)">
          <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z"/>
        </svg>
      </span>
    </a>
    
    
    <!-- Floating go to next button -->
    <a href="/kliveide/documents/statements#article" id="go-to-next">
      <span>
        <svg width="32" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 16" transform="rotate(90)">
          <path d="M10 10l-1.5 1.5L5 7.75 1.5 11.5 0 10l5-5z"/>
        </svg>
      </span>
    </a>
    

    <script>
      window.addEventListener("scroll", function(){
        var scrolled = window.pageYOffset > 50;
        document.getElementById("return-to-top").style.display = scrolled ? "block" : "none";
        var prevEl = document.getElementById("go-to-prev");
        if (prevEl) prevEl.style.display = scrolled ? "block" : "none";
        var nextEl = document.getElementById("go-to-next");
        if (nextEl) nextEl.style.display = scrolled ? "block" : "none";
      });
      var intervalId = 0;
      var $scrollButton = document.querySelector('#return-to-top');
      function scrollStep() {
        if (window.pageYOffset === 0) {
          clearInterval(intervalId);
        }
        window.scroll(0, window.pageYOffset - 50);
      }
      function scrollToTop() {
        intervalId = setInterval(scrollStep, 6.66);
      }
      $scrollButton.addEventListener('click', scrollToTop);

      function handleClick(arg) {
        var nextEl = arg.nextElementSibling;
        var extEl = arg.children[1];
        if (arg.classList.contains("expanded")) {
          arg.classList.remove("expanded");
          arg.classList.add("collapsed");
          extEl.classList.remove("expanded");
          extEl.classList.add("collapsed");
          nextEl.classList.remove("displayed")
          nextEl.classList.add("hidden")
        } else {
          arg.classList.remove("collapsed");
          arg.classList.add("expanded");
          extEl.classList.remove("collapsed");
          extEl.classList.add("expanded");
          nextEl.classList.remove("hidden")
          nextEl.classList.add("displayed")
        }
      }
    </script>

    
  </body>
</html>